---
import Layout from "../../layouts/admin-layout.astro";
import AdminSidebar from "../../components/Admin-site/admin-sidebar.astro";
import AdminTopbar from "../../components/Admin-site/admin-topbar.astro";
---

<Layout>
  <AdminSidebar slot="sidebar" complexName="Komplek Anggrek Asri" complexImage="https://images.unsplash.com/photo-1570129477492-45c003edd2be?w=100&h=100&fit=crop&crop=center" />
  <AdminTopbar slot="topbar" complexName="Komplek Anggrek Asri" complexImage="https://images.unsplash.com/photo-1570129477492-45c003edd2be?w=100&h=100&fit=crop&crop=center" />
  <div class="anggaran-page">
    <!-- Header -->
    <section class="section-header-card pre-anim">
      <div class="section-header-left">
        <div class="section-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4"/>
            <path d="M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4"/>
          <path d="M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4"/>
        </svg>
      </div>
      <div class="section-title">
        <h1>Manajemen Anggaran</h1>
        <p class="subtitle">Pemantauan anggaran Rencana vs Realisasi — semua fitur aktif.</p>
      </div>
    </div>
    <div class="section-actions">
      <button class="btn secondary" id="btn-print" aria-label="Cetak">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="6,9 6,2 18,2 18,9"/>
          <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/>
          <rect x="6" y="14" width="12" height="8"/>
        </svg>
        <span>Cetak</span>
      </button>
      <button class="btn secondary" id="btn-export" aria-label="Ekspor CSV">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <polyline points="14,2 14,8 20,8"/>
          <line x1="16" y1="13" x2="8" y2="13"/>
          <line x1="16" y1="17" x2="8" y2="17"/>
          <polyline points="10,9 9,9 8,9"/>
        </svg>
        <span>Ekspor CSV</span>
      </button>
      <button class="btn primary" id="btn-open-drawer" aria-label="Buat Rencana">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="16"/>
          <line x1="8" y1="12" x2="16" y2="12"/>
        </svg>
        <span>Buat Rencana</span>
      </button>
    </div>
  </section>

  <!-- Toolbar -->
  <section class="toolbar-section pre-anim" role="region" aria-label="Filter dan kontrol anggaran">
    <div class="toolbar">
      <div class="toolbar-group">
        <div class="field">
          <label>Periode Cepat</label>
          <div class="chip-group" role="tablist" aria-label="Preset periode">
            <button class="chip active" data-preset="bulan-ini" role="tab" aria-selected="true">Bulan Ini</button>
            <button class="chip" data-preset="bulan-lalu" role="tab">Bulan Lalu</button>
            <button class="chip" data-preset="qtd" role="tab">QTD</button>
            <button class="chip" data-preset="ytd" role="tab">YTD</button>
            <button class="chip" data-preset="semua" role="tab">Semua</button>
          </div>
        </div>

        <div class="field">
          <label for="filter-start">Dari</label>
          <input type="date" id="filter-start" />
        </div>

        <div class="field">
          <label for="filter-end">Sampai</label>
          <input type="date" id="filter-end" />
        </div>

        <div class="field">
          <label for="filter-cat">Kategori</label>
          <select id="filter-cat">
            <option value="Semua">Semua</option>
          </select>
        </div>

        <div class="field">
          <label for="filter-q">Cari</label>
          <div class="input-wrap">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/>
              <path d="m21 21-4.35-4.35"/>
            </svg>
            <input type="text" id="filter-q" placeholder="Ketik kegiatan/kategori..." autocomplete="off" />
          </div>
        </div>

        <div class="field">
          <label for="filter-min">Min Rencana</label>
          <input type="number" id="filter-min" placeholder="0" min="0" step="1000" />
        </div>

        <div class="field">
          <label for="filter-max">Maks Rencana</label>
          <input type="number" id="filter-max" placeholder="—" min="0" step="1000" />
        </div>
      </div>

      <div class="toolbar-actions">
        <button id="btn-reset" class="btn secondary" aria-label="Atur ulang filter">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="1 4 1 10 7 10"/>
            <polyline points="23 20 23 14 17 14"/>
            <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
          </svg>
          <span>Atur Ulang</span>
        </button>
      </div>
    </div>
  </section>

  <!-- KPI Cards -->
  <section class="kpi-grid pre-anim" aria-label="Summary">
    <div class="kpi-card blue">
      <div class="kpi-icon">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
          <line x1="16" y1="2" x2="16" y2="6"/>
          <line x1="8" y1="2" x2="8" y2="6"/>
          <line x1="3" y1="10" x2="21" y2="10"/>
        </svg>
      </div>
      <div class="kpi-content">
        <div class="kpi-label">Total Rencana</div>
        <div class="kpi-value" id="sum-plan" aria-live="polite">Rp0</div>
      </div>
    </div>
    
    <div class="kpi-card green">
      <div class="kpi-icon">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
          <polyline points="22 4 12 14.01 9 11.01"/>
        </svg>
      </div>
      <div class="kpi-content">
        <div class="kpi-label">Total Realisasi</div>
        <div class="kpi-value" id="sum-real" aria-live="polite">Rp0</div>
      </div>
    </div>
    
    <div class="kpi-card slate">
      <div class="kpi-icon">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4"/>
          <path d="M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4"/>
        </svg>
      </div>
      <div class="kpi-content">
        <div class="kpi-label">Sisa</div>
        <div class="kpi-value" id="sum-remain" aria-live="polite">Rp0</div>
      </div>
    </div>
  </section>

  <!-- Charts -->
  <section class="charts-grid pre-anim">
    <div class="chart-card">
      <div class="chart-header">
        <h3>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="20" x2="18" y2="10"/>
            <line x1="12" y1="20" x2="12" y2="4"/>
            <line x1="6" y1="20" x2="6" y2="14"/>
          </svg>
          Rencana vs Realisasi
        </h3>
        <div class="card-actions">
          <button class="action-button" aria-label="Unduh grafik" title="Unduh PNG">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/>
              <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
          </button>
          <button class="action-button" aria-label="Layar penuh" title="Layar penuh">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 3 21 3 21 9"/>
              <polyline points="9 21 3 21 3 15"/>
              <line x1="21" y1="3" x2="14" y2="10"/>
              <line x1="3" y1="21" x2="10" y2="14"/>
            </svg>
          </button>
        </div>
      </div>
      <div class="chart-body">
        <div class="skeleton" id="sk-b1"></div>
        <canvas id="bud-plan-real" aria-label="Plan vs actual chart" role="img"></canvas>
      </div>
    </div>

    <div class="chart-card">
      <div class="chart-header">
        <h3>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21.21 15.89A10 10 0 1 1 8 2.83"/>
            <path d="M22 12A10 10 0 0 0 12 2v10z"/>
          </svg>
          Komposisi Anggaran
        </h3>
        <div class="card-actions">
          <button class="action-button" aria-label="Unduh grafik" title="Unduh PNG">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/>
              <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
          </button>
          <button class="action-button" aria-label="Layar penuh" title="Layar penuh">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 3 21 3 21 9"/>
              <polyline points="9 21 3 21 3 15"/>
              <line x1="21" y1="3" x2="14" y2="10"/>
              <line x1="3" y1="21" x2="10" y2="14"/>
            </svg>
          </button>
        </div>
      </div>
      <div class="chart-body">
        <div class="skeleton" id="sk-b2"></div>
        <canvas id="bud-pie" aria-label="Budget composition chart" role="img"></canvas>
      </div>
    </div>

    <div class="chart-card">
      <div class="chart-header">
        <h3>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="20" x2="12" y2="10"/>
            <line x1="18" y1="20" x2="18" y2="4"/>
            <line x1="6" y1="20" x2="6" y2="16"/>
          </svg>
          Progres per Kategori
        </h3>
        <div class="card-actions">
          <button class="action-button" aria-label="Unduh grafik" title="Unduh PNG">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/>
              <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
          </button>
          <button class="action-button" aria-label="Layar penuh" title="Layar penuh">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 3 21 3 21 9"/>
              <polyline points="9 21 3 21 3 15"/>
              <line x1="21" y1="3" x2="14" y2="10"/>
              <line x1="3" y1="21" x2="10" y2="14"/>
            </svg>
          </button>
        </div>
      </div>
      <div class="chart-body">
        <div class="skeleton" id="sk-b3"></div>
        <canvas id="bud-progress" aria-label="Progress by category chart" role="img"></canvas>
      </div>
    </div>
  </section>

  <!-- Analysis & Plans -->
  <section class="analysis-grid pre-anim">
    <div class="content-card waste-detection">
      <div class="content-header">
        <h3>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="m21 21-6-6m2-5a7 7 0 1 1-14 0 7 7 0 0 1 14 0z"/>
            <path d="m9 12 2 2 4-4"/>
          </svg>
          Deteksi Pemborosan
        </h3>
      </div>
      <div class="content-body">
        <div class="waste-analysis">
          <div class="waste-status">
            <div class="status-icon success">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12 14.01 9 11.01"/>
              </svg>
            </div>
            <div class="status-content">
              <h4>Tidak ditemukan pemborosan</h4>
              <p>pada rencana aktif</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="content-card plan-list">
      <div class="content-header">
        <h3>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2z"/>
          </svg>
          Daftar Rencana
        </h3>
      </div>
      <div class="content-body">
        <div class="table-container">
          <table class="modern-table plan-table" aria-label="Daftar rencana anggaran tersimpan">
            <thead>
              <tr>
                <th>JUDUL</th>
                <th>PERIODE</th>
                <th class="text-right">RENCANA</th>
                <th class="text-right">REALISASI</th>
                <th class="text-right">SISA</th>
                <th class="text-center">AKSI</th>
              </tr>
            </thead>
            <tbody id="plan-tbody">
              <tr class="plan-row active">
                <td class="plan-title">
                  <div class="title-content">
                    <span class="title-text">Rencana Bulan Ini (Demo)</span>
                    <span class="demo-badge">DEMO</span>
                  </div>
                </td>
                <td class="plan-period">01 Agu 2025 - 31 Agu 2025</td>
                <td class="text-right amount plan">Rp 8.450.000</td>
                <td class="text-right amount real">Rp 3.200.000</td>
                <td class="text-right amount remain">Rp 5.250.000</td>
                <td class="text-center">
                  <button class="btn-status active">Aktif</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <!-- Mobile Card View for Plans -->
        <div class="mobile-cards" id="plan-mobile-cards" style="display: none;">
          <div class="mobile-plan-card active">
            <div class="mobile-plan-header">
              <div class="mobile-plan-title">
                <span class="title-text">Rencana Bulan Ini (Demo)</span>
                <span class="demo-badge">DEMO</span>
              </div>
              <div class="mobile-plan-status">
                <button class="btn-status active">Aktif</button>
              </div>
            </div>
            <div class="mobile-plan-body">
              <div class="mobile-plan-row">
                <span class="label">Periode:</span>
                <span class="value">01 Agu 2025 - 31 Agu 2025</span>
              </div>
              <div class="mobile-plan-row">
                <span class="label">Rencana:</span>
                <span class="value amount plan">Rp 8.450.000</span>
              </div>
              <div class="mobile-plan-row">
                <span class="label">Realisasi:</span>
                <span class="value amount real">Rp 3.200.000</span>
              </div>
              <div class="mobile-plan-row">
                <span class="label">Sisa:</span>
                <span class="value amount remain">Rp 5.250.000</span>
              </div>
            </div>
          </div>
        </div>
        <div class="note" id="active-plan-note"></div>
      </div>
    </div>
  </section>

  <!-- Budget Detail -->
  <div class="content-card budget-detail pre-anim">
    <div class="content-header">
      <h3>
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
          <line x1="16" y1="2" x2="16" y2="6"/>
          <line x1="8" y1="2" x2="8" y2="6"/>
          <line x1="3" y1="10" x2="21" y2="10"/>
          <path d="m9 16 2 2 4-4"/>
        </svg>
        Detail Anggaran
      </h3>
    </div>
    <div class="content-body">
              <div class="table-container">
          <table class="modern-table budget-table" aria-label="Active plan detail">
            <thead>
              <tr>
                <th>KEGIATAN</th>
                <th>KATEGORI</th>
                <th class="text-right">RENCANA</th>
                <th class="text-right">REALISASI</th>
                <th class="text-right">SISA</th>
                <th class="text-right">% REALISASI</th>
              </tr>
            </thead>
            <tbody id="budget-tbody">
              <tr class="budget-row">
                <td class="activity-name">Perawatan Taman</td>
                <td class="category">
                  <span class="category-badge environment">Environment</span>
                </td>
                <td class="text-right amount plan">Rp 1.200.000</td>
                <td class="text-right amount real">Rp 400.000</td>
                <td class="text-right amount remain">Rp 800.000</td>
                <td class="text-right">
                  <div class="progress-indicator">
                    <span class="progress-text">33%</span>
                    <div class="progress-bar">
                      <div class="progress-fill" style="width: 33%"></div>
                    </div>
                  </div>
                </td>
              </tr>
              <tr class="budget-row">
                <td class="activity-name">Satpam</td>
                <td class="category">
                  <span class="category-badge security">Security</span>
                </td>
                <td class="text-right amount plan">Rp 2.000.000</td>
                <td class="text-right amount real">Rp 1.200.000</td>
                <td class="text-right amount remain">Rp 800.000</td>
                <td class="text-right">
                  <div class="progress-indicator">
                    <span class="progress-text">60%</span>
                    <div class="progress-bar">
                      <div class="progress-fill" style="width: 60%"></div>
                    </div>
                  </div>
                </td>
              </tr>
              <tr class="budget-row">
                <td class="activity-name">Kebersihan Harian</td>
                <td class="category">
                  <span class="category-badge cleanliness">Cleanliness</span>
                </td>
                <td class="text-right amount plan">Rp 1.500.000</td>
                <td class="text-right amount real">Rp 900.000</td>
                <td class="text-right amount remain">Rp 600.000</td>
                <td class="text-right">
                  <div class="progress-indicator">
                    <span class="progress-text">60%</span>
                    <div class="progress-bar">
                      <div class="progress-fill" style="width: 60%"></div>
                    </div>
                  </div>
                </td>
              </tr>
              <tr class="budget-row">
                <td class="activity-name">ATK & Administrasi</td>
                <td class="category">
                  <span class="category-badge admin">Administration</span>
                </td>
                <td class="text-right amount plan">Rp 600.000</td>
                <td class="text-right amount real">Rp 150.000</td>
                <td class="text-right amount remain">Rp 450.000</td>
                <td class="text-right">
                  <div class="progress-indicator">
                    <span class="progress-text">25%</span>
                    <div class="progress-bar">
                      <div class="progress-fill" style="width: 25%"></div>
                    </div>
                  </div>
                </td>
              </tr>
              <tr class="budget-row">
                <td class="activity-name">Perbaikan Lampu</td>
                <td class="category">
                  <span class="category-badge facilities">Facilities</span>
                </td>
                <td class="text-right amount plan">Rp 900.000</td>
                <td class="text-right amount real">Rp 300.000</td>
                <td class="text-right amount remain">Rp 600.000</td>
                <td class="text-right">
                  <div class="progress-indicator">
                    <span class="progress-text">33%</span>
                    <div class="progress-bar">
                      <div class="progress-fill" style="width: 33%"></div>
                    </div>
                  </div>
                </td>
              </tr>
              <tr class="budget-row">
                <td class="activity-name">Santunan</td>
                <td class="category">
                  <span class="category-badge social">Social</span>
                </td>
                <td class="text-right amount plan">Rp 500.000</td>
                <td class="text-right amount real">Rp 250.000</td>
                <td class="text-right amount remain">Rp 250.000</td>
                <td class="text-right">
                  <div class="progress-indicator">
                    <span class="progress-text">50%</span>
                    <div class="progress-bar">
                      <div class="progress-fill" style="width: 50%"></div>
                    </div>
                  </div>
                </td>
              </tr>
              <tr class="budget-row">
                <td class="activity-name">HUT RT</td>
                <td class="category">
                  <span class="category-badge events">Events</span>
                </td>
                <td class="text-right amount plan">Rp 1.000.000</td>
                <td class="text-right amount real">Rp 0</td>
                <td class="text-right amount remain">Rp 1.000.000</td>
                <td class="text-right">
                  <div class="progress-indicator">
                    <span class="progress-text">0%</span>
                    <div class="progress-bar">
                      <div class="progress-fill" style="width: 0%"></div>
                    </div>
                  </div>
                </td>
              </tr>
              <tr class="budget-row">
                <td class="activity-name">Dana Cadangan</td>
                <td class="category">
                  <span class="category-badge reserve">Reserve</span>
                </td>
                <td class="text-right amount plan">Rp 750.000</td>
                <td class="text-right amount real">Rp 0</td>
                <td class="text-right amount remain">Rp 750.000</td>
                <td class="text-right">
                  <div class="progress-indicator">
                    <span class="progress-text">0%</span>
                    <div class="progress-bar">
                      <div class="progress-fill" style="width: 0%"></div>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <!-- Mobile Card View for Budget -->
        <div class="mobile-cards" id="budget-mobile-cards" style="display: none;">
          <div class="mobile-budget-card">
            <div class="mobile-budget-header">
              <div class="mobile-budget-title">Perawatan Taman</div>
              <span class="category-badge environment">Environment</span>
            </div>
            <div class="mobile-budget-body">
              <div class="mobile-budget-row">
                <span class="label">Rencana:</span>
                <span class="value amount plan">Rp 1.200.000</span>
              </div>
              <div class="mobile-budget-row">
                <span class="label">Realisasi:</span>
                <span class="value amount real">Rp 400.000</span>
              </div>
              <div class="mobile-budget-row">
                <span class="label">Sisa:</span>
                <span class="value amount remain">Rp 800.000</span>
              </div>
              <div class="mobile-budget-progress">
                <span class="progress-label">Realisasi: 33%</span>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 33%"></div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="mobile-budget-card">
            <div class="mobile-budget-header">
              <div class="mobile-budget-title">Satpam</div>
              <span class="category-badge security">Security</span>
            </div>
            <div class="mobile-budget-body">
              <div class="mobile-budget-row">
                <span class="label">Rencana:</span>
                <span class="value amount plan">Rp 2.000.000</span>
              </div>
              <div class="mobile-budget-row">
                <span class="label">Realisasi:</span>
                <span class="value amount real">Rp 1.200.000</span>
              </div>
              <div class="mobile-budget-row">
                <span class="label">Sisa:</span>
                <span class="value amount remain">Rp 800.000</span>
              </div>
              <div class="mobile-budget-progress">
                <span class="progress-label">Realisasi: 60%</span>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 60%"></div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="mobile-budget-card">
            <div class="mobile-budget-header">
              <div class="mobile-budget-title">Kebersihan Harian</div>
              <span class="category-badge cleanliness">Cleanliness</span>
            </div>
            <div class="mobile-budget-body">
              <div class="mobile-budget-row">
                <span class="label">Rencana:</span>
                <span class="value amount plan">Rp 1.500.000</span>
              </div>
              <div class="mobile-budget-row">
                <span class="label">Realisasi:</span>
                <span class="value amount real">Rp 900.000</span>
              </div>
              <div class="mobile-budget-row">
                <span class="label">Sisa:</span>
                <span class="value amount remain">Rp 600.000</span>
              </div>
              <div class="mobile-budget-progress">
                <span class="progress-label">Realisasi: 60%</span>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 60%"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
    </div>
  </div>

  <!-- Drawer: Create Budget Plan -->
  <aside class="drawer" id="drawer">
    <div class="drawer-header">
      <h3>
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
          <polyline points="14 2 14 8 20 8"/>
          <line x1="16" y1="13" x2="8" y2="13"/>
          <line x1="16" y1="17" x2="8" y2="17"/>
          <polyline points="10 9 9 9 8 9"/>
        </svg>
        Buat Rencana Anggaran
      </h3>
      <button class="btn secondary" id="btn-close-drawer" aria-label="Close">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
        <span>Close</span>
      </button>
    </div>
    <form id="form-plan" class="drawer-body" novalidate>
      <div class="field">
        <label for="plan-title">Judul Rencana</label>
        <input id="plan-title" type="text" placeholder="Contoh: Anggaran Agustus 2025" required />
        <div class="error" id="err-title" aria-live="polite"></div>
      </div>
      
      <div class="grid-2">
        <div class="field">
          <label for="plan-start">Periode Dari</label>
          <input id="plan-start" type="date" required />
          <div class="error" id="err-start" aria-live="polite"></div>
        </div>
        <div class="field">
          <label for="plan-end">Periode Sampai</label>
          <input id="plan-end" type="date" required />
          <div class="error" id="err-end" aria-live="polite"></div>
        </div>
      </div>

      <div class="grid-2">
        <div class="field">
          <label for="plan-owner">Penanggung Jawab</label>
          <input id="plan-owner" type="text" placeholder="Nama penanggung jawab" />
        </div>
        <div class="field">
          <label for="plan-tags">Tag</label>
          <input id="plan-tags" type="text" placeholder="Pisahkan dengan koma, contoh: rutin, 2025-Q1" />
        </div>
      </div>

      <div class="grid-2">
        <div class="field">
          <label for="plan-cont-pct">Cadangan (%)</label>
          <input id="plan-cont-pct" type="number" min="0" max="50" step="1" placeholder="0" />
          <div class="hint">Opsional. Jika diisi, nilai rupiah dihitung otomatis dari persentase ini.</div>
        </div>
        <div class="field">
          <label for="plan-cont-amt">Cadangan (Rp)</label>
          <input id="plan-cont-amt" type="number" min="0" step="1000" placeholder="0" />
          <div class="hint">Opsional. Isi salah satu: persentase atau nominal rupiah langsung.</div>
        </div>
      </div>

      <div class="field">
        <label for="plan-note">Catatan</label>
        <textarea id="plan-note" rows="3" placeholder="Tambahkan catatan kebijakan atau asumsi..."></textarea>
      </div>

      <div class="divider"></div>

      <div class="section-header">
        <h4>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="8" y1="6" x2="21" y2="6"/>
            <line x1="8" y1="12" x2="21" y2="12"/>
            <line x1="8" y1="18" x2="21" y2="18"/>
            <line x1="3" y1="6" x2="3.01" y2="6"/>
            <line x1="3" y1="12" x2="3.01" y2="12"/>
            <line x1="3" y1="18" x2="3.01" y2="18"/>
          </svg>
          Item Anggaran
        </h4>
        <div class="section-actions">
          <button type="button" class="btn secondary" id="btn-add-item">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <line x1="12" y1="8" x2="12" y2="16"/>
              <line x1="8" y1="12" x2="16" y2="12"/>
            </svg>
            <span>Tambah Item</span>
          </button>
          <button type="button" class="btn secondary" id="btn-add-preset">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
            </svg>
            <span>Contoh Preset</span>
          </button>
        </div>
      </div>

      <div id="item-list" class="item-list">
        <!-- item rows injected -->
      </div>

      <div id="plan-preview" class="preview-box">
        <div class="preview-header">
          <strong>Ringkasan:</strong>
        </div>
        <div class="preview-content">
          <div class="preview-row">
            <span>Total Item Rencana:</span>
            <span id="pv-plan-items">Rp0</span>
          </div>
          <div class="preview-row">
            <span>Cadangan:</span>
            <span id="pv-cont">Rp0</span>
          </div>
          <div class="preview-row total">
            <span>Total Rencana + Cadangan:</span>
            <span id="pv-plan-total">Rp0</span>
          </div>
        </div>
      </div>

      <div class="drawer-actions">
        <button type="submit" class="btn primary">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
            <polyline points="17 21 17 13 7 13 7 21"/>
            <polyline points="7 3 7 8 15 8"/>
          </svg>
          <span>Simpan Rencana</span>
        </button>
      </div>
    </form>
  </aside>

  <div class="drawer-backdrop" id="drawer-backdrop" aria-hidden="true"></div>
</div>

  <style>
    .anggaran-page {
      --surface: #ffffff;
      --surface-2: #f8fafc;
      --surface-3: #f1f5f9;
      --outline: #e2e8f0;
      --outline-2: #cbd5e1;
      --text: #0f172a;
      --text-subtle: #64748b;
      --text-muted: #94a3b8;
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --primary-light: #dbeafe;
      --success: #10b981;
      --warning: #f59e0b;
      --error: #ef4444;
      --blue: #3b82f6;
      --green: #10b981;
      --slate: #64748b;
      --radius: 12px;
      --radius-lg: 16px;
      --spacing: 1rem;
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
    }

    /* Layout & Structure */
    .section-header-card {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--surface);
      border: 1px solid var(--outline);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: var(--shadow);
    }
    
    @media (max-width: 768px) {
      .section-header-card {
        padding: 1.25rem;
        margin-bottom: 1.25rem;
        flex-wrap: wrap;
        gap: 1rem;
      }
    }
    
    @media (max-width: 480px) {
      .section-header-card {
        padding: 1rem;
        margin-bottom: 1rem;
        flex-direction: column;
        align-items: flex-start;
      }
    }

    .section-header-left {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .section-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 3rem;
      height: 3rem;
      border-radius: var(--radius);
      background: var(--surface-3);
      color: var(--primary);
      border: 1px solid var(--outline);
    }
    
    @media (max-width: 768px) {
      .section-icon {
        width: 2.5rem;
        height: 2.5rem;
      }
    }
    
    @media (max-width: 480px) {
      .section-icon {
        width: 2rem;
        height: 2rem;
      }
      
      .section-icon svg {
        width: 16px;
        height: 16px;
      }
    }

    .section-title h1 {
      margin: 0;
      font-size: 1.875rem;
      font-weight: 700;
      color: var(--text);
      line-height: 1.2;
    }

    .subtitle {
      color: var(--text-subtle);
      font-weight: 500;
      margin: 0.25rem 0 0 0;
      font-size: 0.875rem;
    }
    
    @media (max-width: 768px) {
      .section-title h1 {
        font-size: 1.5rem;
      }
    }
    
    @media (max-width: 480px) {
      .section-title h1 {
        font-size: 1.25rem;
      }
      
      .subtitle {
        font-size: 0.8125rem;
      }
    }

    .section-actions {
      display: flex;
      gap: 0.75rem;
      align-items: center;
      flex-wrap: wrap;
    }
    
    /* Grid Layout */
    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }
    
    @media (max-width: 768px) {
      .grid-2 {
        gap: 0.75rem;
      }
    }
    
    @media (max-width: 480px) {
      .grid-2 {
        grid-template-columns: 1fr;
        gap: 0.5rem;
      }
    }

    /* Toolbar */
    .toolbar-section {
      background: var(--surface);
      border: 1px solid var(--outline);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: var(--shadow);
    }
    
    @media (max-width: 768px) {
      .toolbar-section {
        padding: 1.25rem;
        margin-bottom: 1.25rem;
      }
    }
    
    @media (max-width: 480px) {
      .toolbar-section {
        padding: 1rem;
        margin-bottom: 1rem;
      }
    }

    .toolbar {
      display: flex;
      gap: 1.5rem;
      justify-content: space-between;
      align-items: flex-end;
      flex-wrap: wrap;
    }
    
    @media (max-width: 768px) {
      .toolbar {
        gap: 1rem;
      }
    }
    
    @media (max-width: 480px) {
      .toolbar {
        gap: 0.75rem;
        flex-direction: column;
        align-items: stretch;
      }
    }

    .toolbar-group {
      display: grid;
      grid-template-columns: repeat(6, minmax(0, 1fr));
      gap: 1rem;
      align-items: end;
      flex: 1;
    }
    
    @media (max-width: 1024px) {
      .toolbar-group {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }
    
    @media (max-width: 640px) {
      .toolbar-group {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }
    
    @media (max-width: 480px) {
      .toolbar-group {
        grid-template-columns: repeat(1, minmax(0, 1fr));
      }
    }

    .toolbar-actions {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    @media (max-width: 480px) {
      .toolbar-actions {
        width: 100%;
        justify-content: flex-end;
      }
    }

    /* Form Elements */
    .field {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }
    
    @media (max-width: 480px) {
      .field {
        margin-bottom: 0.5rem;
      }
    }

    .field label {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-subtle);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    input[type="date"],
    input[type="number"],
    input[type="text"],
    textarea,
    select {
      background: var(--surface);
      border: 1px solid var(--outline);
      color: var(--text);
      border-radius: var(--radius);
      padding: 0.75rem 1rem;
      font-weight: 500;
      outline: none;
      transition: all 0.2s ease;
      font-size: 0.875rem;
      max-width: 100%;
    }
    
    @media (max-width: 480px) {
      input[type="date"],
      input[type="number"],
      input[type="text"],
      textarea,
      select {
        padding: 0.5rem 0.75rem;
        font-size: 0.8125rem;
      }
    }

    input[type="date"]:focus,
    input[type="number"]:focus,
    input[type="text"]:focus,
    textarea:focus,
    select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px var(--primary-light);
    }

    .input-wrap {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: var(--surface);
      border: 1px solid var(--outline);
      border-radius: var(--radius);
      padding: 0.75rem 1rem;
      transition: all 0.2s ease;
    }
    
    @media (max-width: 480px) {
      .input-wrap {
        padding: 0.5rem 0.75rem;
        gap: 0.5rem;
      }
    }

    .input-wrap:focus-within {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px var(--primary-light);
    }

    .input-wrap svg {
      color: var(--text-subtle);
      flex-shrink: 0;
    }

    .input-wrap input {
      background: transparent;
      border: none;
      padding: 0;
      outline: none;
      flex: 1;
    }

    .input-wrap input:focus {
      box-shadow: none;
      border-color: transparent;
    }

    /* Chips */
    .chip-group {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      width: 100%;
    }

    .chip {
      background: var(--surface-2);
      border: 1px solid var(--outline);
      color: var(--text);
      border-radius: 2rem;
      padding: 0.5rem 1rem;
      font-weight: 600;
      font-size: 0.75rem;
      transition: all 0.2s ease;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      flex: 1;
      text-align: center;
      min-width: 80px;
    }
    
    @media (max-width: 768px) {
      .chip {
        padding: 0.5rem 0.75rem;
        min-width: 70px;
      }
    }
    
    @media (max-width: 480px) {
      .chip {
        padding: 0.4rem 0.6rem;
        font-size: 0.7rem;
        min-width: 60px;
      }
    }

    .chip.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.75rem 1.25rem;
      border-radius: var(--radius);
      font-weight: 600;
      font-size: 0.875rem;
      transition: all 0.2s ease;
      cursor: pointer;
      outline: none;
      border: 1px solid transparent;
      text-decoration: none;
      white-space: nowrap;
    }
    
    @media (max-width: 768px) {
      .btn {
        padding: 0.6rem 1rem;
      }
    }
    
    @media (max-width: 480px) {
      .btn {
        padding: 0.5rem 0.75rem;
        font-size: 0.8125rem;
      }
      
      .btn svg {
        width: 14px;
        height: 14px;
      }
    }

    .btn.primary {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .btn.primary:focus {
      box-shadow: 0 0 0 3px var(--primary-light);
    }

    .btn.secondary {
      background: var(--surface-2);
      color: var(--text);
      border-color: var(--outline);
    }

    .btn.secondary:focus {
      box-shadow: 0 0 0 3px var(--primary-light);
    }

    .btn svg {
      flex-shrink: 0;
    }

    /* KPI Grid */
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }
    
    @media (max-width: 768px) {
      .kpi-grid {
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1rem;
      }
    }
    
    @media (max-width: 480px) {
      .kpi-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
    }

    .kpi-card {
      display: flex;
      align-items: center;
      gap: 1rem;
      background: var(--surface);
      border: 1px solid var(--outline);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      box-shadow: var(--shadow);
      min-height: 120px;
    }
    
    @media (max-width: 768px) {
      .kpi-card {
        padding: 1.25rem;
        min-height: 100px;
      }
    }
    
    @media (max-width: 480px) {
      .kpi-card {
        padding: 1rem;
        min-height: 90px;
      }
    }

    .kpi-card.blue .kpi-icon {
      background: var(--blue);
    }

    .kpi-card.green .kpi-icon {
      background: var(--green);
    }

    .kpi-card.slate .kpi-icon {
      background: var(--slate);
    }

    .kpi-icon {
      width: 3rem;
      height: 3rem;
      border-radius: var(--radius);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      flex-shrink: 0;
    }

    .kpi-content {
      flex: 1;
      min-width: 0;
    }

    .kpi-label {
      color: var(--text-subtle);
      font-weight: 600;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.25rem;
    }

    .kpi-value {
      font-size: 1.875rem;
      font-weight: 700;
      color: var(--text);
      line-height: 1.2;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    @media (max-width: 768px) {
      .kpi-value {
        font-size: 1.5rem;
      }
    }
    
    @media (max-width: 480px) {
      .kpi-value {
        font-size: 1.25rem;
      }
    }

    /* Charts Grid */
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }
    
    @media (max-width: 768px) {
      .charts-grid {
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1rem;
      }
    }
    
    @media (max-width: 480px) {
      .charts-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
    }

    .chart-card {
      background: var(--surface);
      border: 1px solid var(--outline);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    .chart-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid var(--outline);
      background: var(--surface-2);
    }

    .chart-header h3 {
      margin: 0;
      display: flex;
      gap: 0.75rem;
      align-items: center;
      font-weight: 700;
      color: var(--text);
      font-size: 1rem;
    }
    
    @media (max-width: 480px) {
      .chart-header h3 {
        font-size: 0.875rem;
        gap: 0.5rem;
      }
      
      .chart-header h3 svg {
        width: 14px;
        height: 14px;
      }
    }

    .chart-body {
      height: 320px;
      display: flex;
      position: relative;
      padding: 1rem;
    }
    
    @media (max-width: 768px) {
      .chart-body {
        height: 280px;
      }
    }
    
    @media (max-width: 480px) {
      .chart-body {
        height: 250px;
      }
    }

    .chart-body canvas {
      width: 100% !important;
      height: 100% !important;
    }

    .skeleton {
      position: absolute;
      inset: 1rem;
      border-radius: var(--radius);
      background: var(--surface-3);
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.4; }
      50% { opacity: 0.7; }
    }

    /* Analysis Grid */
    .analysis-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }
    
    @media (max-width: 768px) {
      .analysis-grid {
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 1rem;
      }
    }
    
    @media (max-width: 480px) {
      .analysis-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
    }

    /* Waste Detection Card */
    .waste-detection .waste-analysis {
      padding: 2rem;
      text-align: center;
    }

    .waste-status {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }

    .status-icon {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
    }

    .status-icon.success {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
    }

    .status-content h4 {
      margin: 0;
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text);
    }

    .status-content p {
      margin: 0.25rem 0 0 0;
      color: var(--text-subtle);
      font-size: 0.875rem;
    }

    /* Plan List Card */
    .plan-list .plan-table {
      font-size: 0.875rem;
    }

    .plan-row {
      transition: all 0.2s ease;
    }

    .plan-row:hover {
      background: var(--surface-2);
    }

    .plan-row.active {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(59, 130, 246, 0.05) 100%);
      border-left: 4px solid var(--primary);
    }

    .plan-title .title-content {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .title-text {
      font-weight: 600;
      color: var(--text);
    }

    .demo-badge {
      display: inline-block;
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 6px;
      font-size: 0.7rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      align-self: flex-start;
    }

    .plan-period {
      color: var(--text-subtle);
      font-size: 0.8rem;
    }

    .amount {
      font-weight: 600;
      font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
    }

    .amount.plan {
      color: var(--primary);
    }

    .amount.real {
      color: var(--success);
    }

    .amount.remain {
      color: var(--slate);
    }

    .btn-status {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-status:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    /* Budget Detail Card */
    .budget-detail .budget-table {
      font-size: 0.875rem;
    }

    .budget-row {
      transition: all 0.2s ease;
    }

    .budget-row:hover {
      background: var(--surface-2);
    }

    .budget-row:nth-child(even) {
      background: var(--surface-2);
    }

    .budget-row:hover {
      background: var(--surface-3);
    }

    .activity-name {
      font-weight: 600;
      color: var(--text);
      max-width: 200px;
    }

    .category-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: white;
    }

    .category-badge.environment {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }

    .category-badge.security {
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
    }

    .category-badge.cleanliness {
      background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
    }

    .category-badge.admin {
      background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
    }

    .category-badge.facilities {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    }

    .category-badge.social {
      background: linear-gradient(135deg, #ec4899 0%, #be185d 100%);
    }

    .category-badge.events {
      background: linear-gradient(135deg, #84cc16 0%, #65a30d 100%);
    }

    .category-badge.reserve {
      background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
    }

    .progress-indicator {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 0.5rem;
      min-width: 80px;
    }

    .progress-text {
      font-weight: 600;
      color: var(--text);
      font-size: 0.8rem;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--surface-3);
      border-radius: 4px;
      overflow: hidden;
    }

          .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #10b981 0%, #059669 100%);
        border-radius: 4px;
        transition: width 0.3s ease;
      }

      /* Mobile Cards Styling */
      .mobile-cards {
        display: none;
        gap: 1rem;
        margin-top: 1rem;
      }

      .mobile-plan-card,
      .mobile-budget-card {
        background: var(--surface);
        border: 1px solid var(--outline);
        border-radius: var(--radius-lg);
        overflow: hidden;
        box-shadow: var(--shadow);
        transition: all 0.2s ease;
      }

      .mobile-plan-card:hover,
      .mobile-budget-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }

      .mobile-plan-card.active {
        border-left: 4px solid var(--primary);
      }

      .mobile-plan-header,
      .mobile-budget-header {
        padding: 1rem;
        border-bottom: 1px solid var(--outline);
        background: var(--surface-2);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .mobile-plan-title .title-text {
        font-weight: 600;
        color: var(--text);
        font-size: 0.9rem;
      }

      .mobile-budget-title {
        font-weight: 600;
        color: var(--text);
        font-size: 0.9rem;
      }

      .mobile-plan-body,
      .mobile-budget-body {
        padding: 1rem;
      }

      .mobile-plan-row,
      .mobile-budget-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem 0;
        border-bottom: 1px solid var(--outline);
      }

      .mobile-plan-row:last-child,
      .mobile-budget-row:last-child {
        border-bottom: none;
      }

      .mobile-plan-row .label,
      .mobile-budget-row .label {
        font-weight: 500;
        color: var(--text-subtle);
        font-size: 0.8rem;
      }

      .mobile-plan-row .value,
      .mobile-budget-row .value {
        font-weight: 600;
        color: var(--text);
        font-size: 0.8rem;
      }

      .mobile-budget-progress {
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid var(--outline);
      }

      .progress-label {
        display: block;
        font-weight: 600;
        color: var(--text);
        font-size: 0.8rem;
        margin-bottom: 0.5rem;
      }

      .mobile-budget-progress .progress-bar {
        height: 6px;
        background: var(--surface-3);
        border-radius: 3px;
        overflow: hidden;
      }

      .mobile-budget-progress .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #10b981 0%, #059669 100%);
        border-radius: 3px;
        transition: width 0.3s ease;
      }

    /* Content Cards */
    .content-card {
      background: var(--surface);
      border: 1px solid var(--outline);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    .content-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid var(--outline);
      background: var(--surface-2);
    }
    
    @media (max-width: 768px) {
      .content-header {
        padding: 1rem 1.25rem;
      }
    }
    
    @media (max-width: 480px) {
      .content-header {
        padding: 0.75rem 1rem;
        flex-wrap: wrap;
        gap: 0.5rem;
      }
    }

    .content-header h3 {
      margin: 0;
      display: flex;
      gap: 0.75rem;
      align-items: center;
      font-weight: 700;
      color: var(--text);
      font-size: 1rem;
    }
    
    @media (max-width: 480px) {
      .content-header h3 {
        font-size: 0.875rem;
        gap: 0.5rem;
      }
      
      .content-header h3 svg {
        width: 14px;
        height: 14px;
      }
    }

    .content-body {
      padding: 1.5rem;
    }
    
    @media (max-width: 768px) {
      .content-body {
        padding: 1.25rem;
      }
    }
    
    @media (max-width: 480px) {
      .content-body {
        padding: 1rem;
      }
    }

    /* Tables */
    .table-container {
      overflow-x: auto;
      border: 1px solid var(--outline);
      border-radius: var(--radius);
      margin: -1.5rem;
      margin-top: 0;
      -webkit-overflow-scrolling: touch;
    }
    
    @media (max-width: 768px) {
      .table-container {
        margin: -1.25rem;
        margin-top: 0;
      }
    }
    
    @media (max-width: 480px) {
      .table-container {
        margin: -1rem;
        margin-top: 0;
      }
    }

    .modern-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.875rem;
    }

    .modern-table th,
    .modern-table td {
      padding: 1rem 1.25rem;
      text-align: left;
      border-bottom: 1px solid var(--outline);
    }
    
    @media (max-width: 768px) {
      .modern-table th,
      .modern-table td {
        padding: 0.75rem 1rem;
      }
    }
    
    @media (max-width: 480px) {
      .modern-table th,
      .modern-table td {
        padding: 0.5rem 0.75rem;
        font-size: 0.8125rem;
      }
    }

    .modern-table th {
      background: var(--surface-3);
      color: var(--text);
      font-weight: 700;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    .modern-table .text-right {
      text-align: right;
    }

    .modern-table tbody tr:nth-child(even) {
      background: var(--surface-2);
    }

    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
    }

    .empty-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
      color: var(--text-subtle);
    }

    .empty-content svg {
      opacity: 0.5;
    }

    .empty-content p {
      margin: 0;
      font-weight: 500;
    }

    /* Anomaly List */
    .anomaly-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .anomaly-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      border: 1px solid var(--outline);
      border-radius: var(--radius);
      background: var(--surface-2);
    }

    .loading-state {
      color: var(--text-subtle);
      font-style: italic;
      text-align: center;
      padding: 2rem;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.25rem 0.75rem;
      border-radius: 2rem;
      font-weight: 700;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .badge.warn {
      background: #fef3c7;
      color: #92400e;
      border: 1px solid #fde68a;
    }

    .badge.crit {
      background: #fee2e2;
      color: #b91c1c;
      border: 1px solid #fecaca;
    }

    .note {
      font-size: 0.875rem;
      color: var(--text-subtle);
      font-weight: 500;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid var(--outline);
    }

    /* Drawer */
    .drawer {
      position: fixed;
      top: 0;
      right: -600px;
      width: 600px;
      max-width: 100vw;
      height: 100vh;
      background: var(--surface);
      border-left: 1px solid var(--outline);
      box-shadow: var(--shadow-xl);
      z-index: 50;
      display: flex;
      flex-direction: column;
      transition: right 0.3s ease;
    }
    
    @media (max-width: 768px) {
      .drawer {
        right: -100vw;
        width: 100vw;
      }
    }

    .drawer.open {
      right: 0;
    }

    .drawer-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid var(--outline);
      background: var(--surface-2);
      position: sticky;
      top: 0;
      z-index: 2;
    }
    
    @media (max-width: 768px) {
      .drawer-header {
        padding: 1.125rem 1.25rem;
      }
    }
    
    @media (max-width: 480px) {
      .drawer-header {
        padding: 1rem;
      }
    }

    .drawer-header h3 {
      margin: 0;
      display: flex;
      gap: 0.75rem;
      align-items: center;
      font-weight: 700;
      color: var(--text);
      font-size: 1.125rem;
    }
    
    @media (max-width: 480px) {
      .drawer-header h3 {
        font-size: 1rem;
        gap: 0.5rem;
      }
      
      .drawer-header h3 svg {
        width: 18px;
        height: 18px;
      }
    }

    .drawer-body {
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
      overflow-y: auto;
      flex: 1;
    }
    
    @media (max-width: 768px) {
      .drawer-body {
        padding: 1.25rem;
        gap: 1rem;
      }
    }
    
    @media (max-width: 480px) {
      .drawer-body {
        padding: 1rem;
        gap: 0.75rem;
      }
    }

    .drawer-actions {
      display: flex;
      justify-content: flex-end;
      padding-top: 1.5rem;
      border-top: 1px solid var(--outline);
      margin-top: 1.5rem;
      gap: 0.75rem;
    }
    
    @media (max-width: 480px) {
      .drawer-actions {
        flex-direction: column;
      }
      
      .drawer-actions .btn {
        width: 100%;
        justify-content: center;
      }
    }

    .drawer-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(4px);
      z-index: 40;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .drawer-backdrop.open {
      opacity: 1;
      pointer-events: auto;
    }
    
    @media (max-width: 480px) {
      .drawer-backdrop {
        backdrop-filter: blur(2px);
      }
    }

    /* Form Layout */
    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.25rem;
    }
    
    @media (max-width: 768px) {
      .grid-2 {
        gap: 1rem;
      }
    }
    
    @media (max-width: 480px) {
      .grid-2 {
        grid-template-columns: 1fr;
        gap: 0.75rem;
      }
    }

    .divider {
      height: 1px;
      background: var(--outline);
      margin: 0.5rem 0;
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 0.5rem 0;
    }
    
    @media (max-width: 480px) {
      .section-header {
        flex-wrap: wrap;
        gap: 0.5rem;
      }
    }

    .section-header h4 {
      margin: 0;
      display: flex;
      gap: 0.5rem;
      align-items: center;
      font-weight: 700;
      color: var(--text);
      font-size: 1rem;
    }
    
    @media (max-width: 480px) {
      .section-header h4 {
        font-size: 0.9375rem;
      }
      
      .section-header h4 svg {
        width: 16px;
        height: 16px;
      }
    }

    .section-actions {
      display: flex;
      gap: 0.5rem;
    }

    .hint {
      font-size: 0.75rem;
      color: var(--text-subtle);
      font-weight: 500;
      margin-top: 0.25rem;
      line-height: 1.4;
    }

    .error {
      color: var(--error);
      font-size: 0.75rem;
      font-weight: 600;
      min-height: 1rem;
    }

    /* Item List */
    .item-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .item-row {
      position: relative;
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr auto;
      gap: 1rem;
      align-items: end;
      padding: 1.25rem;
      border: 1px solid var(--outline);
      border-radius: var(--radius);
      background: var(--surface-2);
      border-left: 4px solid var(--accent, var(--slate));
    }
    
    @media (max-width: 768px) {
      .item-row {
        grid-template-columns: 1fr 1fr 1fr;
        gap: 0.75rem;
        padding: 1rem;
      }
    }
    
    @media (max-width: 480px) {
      .item-row {
        grid-template-columns: 1fr;
        gap: 0.5rem;
        padding: 0.75rem;
      }
    }

    .row-head {
      grid-column: 1 / -1;
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }
    
    @media (max-width: 768px) {
      .row-head {
        margin-bottom: 0.75rem;
      }
    }
    
    @media (max-width: 480px) {
      .row-head {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
      }
    }

    .badge.cat {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.25rem 0.75rem;
      border-radius: 2rem;
      font-weight: 700;
      font-size: 0.75rem;
      background: color-mix(in srgb, var(--accent, var(--slate)) 15%, transparent);
      border: 1px solid color-mix(in srgb, var(--accent, var(--slate)) 30%, transparent);
      color: var(--text);
    }
    
    @media (max-width: 480px) {
      .badge.cat {
        padding: 0.2rem 0.5rem;
        font-size: 0.7rem;
        gap: 0.25rem;
      }
      
      .badge.cat svg {
        width: 14px;
        height: 14px;
      }
    }

    .badge.cat svg {
      color: var(--accent, var(--slate));
    }

    .chip.prio {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.25rem 0.75rem;
      border-radius: 2rem;
      font-weight: 700;
      font-size: 0.75rem;
      border: 1px solid var(--outline);
    }

    .chip.prio.high {
      background: #fee2e2;
      color: #b91c1c;
      border-color: #fecaca;
    }

    .chip.prio.med {
      background: #fef3c7;
      color: #92400e;
      border-color: #fde68a;
    }

    .chip.prio.low {
      background: #dcfce7;
      color: #166534;
      border-color: #bbf7d0;
    }

    .item-row .del {
      width: 2.5rem;
      height: 2.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background: #fee2e2;
      border: 1px solid #fecaca;
      color: #b91c1c;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .input-adorn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: var(--surface);
      border: 1px solid var(--outline);
      border-radius: var(--radius);
      padding: 0.75rem 1rem;
      transition: all 0.2s ease;
    }

    .input-adorn:focus-within {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px var(--primary-light);
    }

    .input-adorn .prefix {
      font-weight: 700;
      color: var(--text-subtle);
      font-size: 0.875rem;
    }

    .input-adorn input {
      background: transparent;
      border: 0;
      outline: none;
      color: var(--text);
      flex: 1;
      padding: 0;
      font-weight: 600;
    }

    .input-adorn svg {
      color: var(--text-subtle);
      flex-shrink: 0;
    }

    /* Preview Box */
    .preview-box {
      border: 2px dashed var(--outline);
      border-radius: var(--radius);
      padding: 1.25rem;
      background: var(--surface-2);
    }

    .preview-header {
      font-weight: 700;
      color: var(--text);
      margin-bottom: 1rem;
    }

    .preview-content {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .preview-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
      font-size: 0.875rem;
    }

    .preview-row.total {
      padding-top: 0.75rem;
      border-top: 1px solid var(--outline);
      font-weight: 700;
      font-size: 1rem;
    }

    /* Category Pills */
    .pill {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.75rem;
      border-radius: 2rem;
      font-weight: 600;
      font-size: 0.75rem;
      border: 1px solid var(--outline);
      background: var(--surface-2);
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
      .toolbar-group {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
      
      .charts-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 768px) {
      .section-header-card {
        flex-direction: column;
        gap: 1rem;
        align-items: stretch;
      }

      .section-actions {
        justify-content: center;
      }

      .toolbar {
        flex-direction: column;
        align-items: stretch;
      }

      .toolbar-group {
        grid-template-columns: 1fr;
      }

      .kpi-grid {
        grid-template-columns: 1fr;
      }

      .charts-grid {
        grid-template-columns: 1fr;
      }

      .analysis-grid {
        grid-template-columns: 1fr;
      }

      .grid-2 {
        grid-template-columns: 1fr;
      }

      .item-row {
        grid-template-columns: 1fr 1fr auto;
      }

      .drawer {
        width: 100vw;
        right: -100vw;
      }

      /* Mobile table improvements */
      .plan-table th,
      .plan-table td,
      .budget-table th,
      .budget-table td {
        padding: 0.75rem 0.5rem;
        font-size: 0.8rem;
      }

      .waste-detection .waste-analysis {
        padding: 1.5rem;
      }

      .status-icon {
        width: 48px;
        height: 48px;
        font-size: 20px;
      }

      .status-content h4 {
        font-size: 1.125rem;
      }
    }

    @media (max-width: 640px) {
      .plan-table th,
      .plan-table td,
      .budget-table th,
      .budget-table td {
        padding: 0.5rem 0.25rem;
        font-size: 0.75rem;
      }

      .plan-title .title-content {
        gap: 0.25rem;
      }

      .demo-badge {
        font-size: 0.65rem;
        padding: 0.2rem 0.4rem;
      }

      .category-badge {
        font-size: 0.7rem;
        padding: 0.2rem 0.5rem;
      }

      .progress-indicator {
        min-width: 60px;
      }

      .progress-text {
        font-size: 0.75rem;
      }

      .progress-bar {
        height: 6px;
      }

      /* Show mobile cards, hide tables */
      .table-container {
        display: none;
      }

      .mobile-cards {
        display: flex;
        flex-direction: column;
      }
    }

    @media (max-width: 480px) {
      .section-header-card,
      .toolbar-section,
      .content-card {
        padding: 1rem;
      }

      .drawer-body {
        padding: 1rem;
      }

      .kpi-card {
        padding: 1rem;
        min-height: auto;
      }

      .item-row {
        grid-template-columns: 1fr;
        gap: 0.75rem;
      }

      .row-head {
        margin-bottom: 0.75rem;
      }

      /* Very small screen table adjustments */
      .plan-table th,
      .plan-table td,
      .budget-table th,
      .budget-table td {
        padding: 0.4rem 0.2rem;
        font-size: 0.7rem;
      }

      .waste-detection .waste-analysis {
        padding: 1rem;
      }

      .status-icon {
        width: 40px;
        height: 40px;
        font-size: 18px;
      }

      .status-content h4 {
        font-size: 1rem;
      }

      .status-content p {
        font-size: 0.8rem;
      }

      .btn-status {
        padding: 0.4rem 0.8rem;
        font-size: 0.7rem;
      }

      .amount {
        font-size: 0.7rem;
      }
    }

    @media (max-width: 360px) {
      .plan-table th,
      .plan-table td,
      .budget-table th,
      .budget-table td {
        padding: 0.3rem 0.15rem;
        font-size: 0.65rem;
      }

      .waste-detection .waste-analysis {
        padding: 0.75rem;
      }

      .status-icon {
        width: 36px;
        height: 36px;
        font-size: 16px;
      }

      .status-content h4 {
        font-size: 0.9rem;
      }

      .status-content p {
        font-size: 0.75rem;
      }

      .demo-badge {
        font-size: 0.6rem;
        padding: 0.15rem 0.3rem;
      }

      .category-badge {
        font-size: 0.65rem;
        padding: 0.15rem 0.4rem;
      }

      .progress-indicator {
        min-width: 50px;
      }

      .progress-text {
        font-size: 0.7rem;
      }

      .progress-bar {
        height: 5px;
      }
    }

    /* Animations */
    .pre-anim {
      opacity: 0;
      transform: translateY(20px);
    }

    .reveal {
      opacity: 1;
      transform: none;
      transition: opacity 0.6s ease, transform 0.6s ease;
    }

    /* Print Styles */
    @media print {
      .section-actions,
      .toolbar-section,
      .drawer,
      .drawer-backdrop {
        display: none !important;
      }

      .content-card,
      .chart-card {
        box-shadow: none;
        break-inside: avoid;
      }

      .modern-table th {
        position: static;
      }
    }

    /* Reduced Motion */
    @media (prefers-reduced-motion: reduce) {
      .pre-anim,
      .reveal {
        transition: none !important;
        transform: none !important;
        opacity: 1 !important;
      }

      .skeleton {
        animation: none !important;
      }

      * {
        transition: none !important;
        animation: none !important;
      }
    }
  </style>

  <script>
    // Responsive view switching
    function handleResponsiveView() {
      const planTable = document.querySelector('.plan-table');
      const budgetTable = document.querySelector('.budget-table');
      const planMobileCards = document.getElementById('plan-mobile-cards') as HTMLElement | null;
      const budgetMobileCards = document.getElementById('budget-mobile-cards') as HTMLElement | null;

      function updateView() {
        if (window.innerWidth <= 640) {
          // Mobile view - show cards, hide tables
          const planTableContainer = planTable?.closest('.table-container') as HTMLElement | null;
          const budgetTableContainer = budgetTable?.closest('.table-container') as HTMLElement | null;
          if (planTableContainer) planTableContainer.style.display = 'none';
          if (budgetTableContainer) budgetTableContainer.style.display = 'none';
          if (planMobileCards) planMobileCards.style.display = 'flex';
          if (budgetMobileCards) budgetMobileCards.style.display = 'flex';
        } else {
          // Desktop view - show tables, hide cards
          const planTableContainer = planTable?.closest('.table-container') as HTMLElement | null;
          const budgetTableContainer = budgetTable?.closest('.table-container') as HTMLElement | null;
          if (planTableContainer) planTableContainer.style.display = 'block';
          if (budgetTableContainer) budgetTableContainer.style.display = 'block';
          if (planMobileCards) planMobileCards.style.display = 'none';
          if (budgetMobileCards) budgetMobileCards.style.display = 'none';
        }
      }

      updateView(); // Initial call
      window.addEventListener('resize', updateView); // Update on resize
    }

    // Initialize responsive view
    document.addEventListener('DOMContentLoaded', function() {
      handleResponsiveView();
    });
  </script>

  <script type="module" src="/src/scripts/anggaran.ts"></script>