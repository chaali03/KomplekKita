---
import Layout from "~/layouts/admin-layout.astro";
import AdminSidebar from "../../components/Admin-site/admin-sidebar.astro";
import AdminTopbar from "../../components/Admin-site/admin-topbar.astro";
import laporanClient from "../../scripts/laporan.js?url";
// Complex branding to show in admin UI
const complexName = 'Komplek Anggrek Asri';
const complexImage = 'https://images.unsplash.com/photo-1570129477492-45c003edd2be?w=100&h=100&fit=crop&crop=center';
---

<Layout>
  <AdminSidebar slot="sidebar" complexName={complexName} complexImage={complexImage} />
  <AdminTopbar slot="topbar" complexName={complexName} complexImage={complexImage} />

  <!-- Header -->
  <section class="header-section">
    <div class="header-content">
      <div class="header-info">
        <div class="icon-container">
          <i class="fas fa-chart-bar"></i>
        </div>

  <!-- Import Modal -->
  <div id="import-modal" class="modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="import-title">
    <div class="modal-backdrop" data-close></div>
    <div class="modal-card" style="max-width: 920px;">
      <div class="modal-header">
        <h3 id="import-title"><i class="fas fa-file-import"></i> Impor Transaksi</h3>
        <button class="btn soft pressable" id="btn-close-import" aria-label="Tutup"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <div class="field">
          <label>Template</label>
          <div class="template-actions">
            <button class="btn soft pressable" id="btn-open-template"><i class="fas fa-table"></i><span>Download Template</span></button>
            <button class="btn soft pressable" id="btn-template-keuangan" style="display:none"><i class="fas fa-table"></i><span>Unduh Template</span></button>
          </div>
        </div>
        <div class="field">
          <label>File CSV/Excel</label>
          <div id="csv-dropzone" tabindex="0" class="status-grid" style="padding:16px; border:1px dashed var(--border); border-radius:12px; background: var(--surface-secondary); cursor: pointer;">
            <div style="display:flex; gap:10px; align-items:center; color: var(--text-secondary);">
              <i class="fas fa-cloud-upload-alt"></i>
              <div>
                <div>Pilih atau tarik file ke sini</div>
                <div id="csv-fileinfo" class="muted" style="font-size:12px"></div>
              </div>
            </div>
            <input id="csv-file" type="file" accept=".csv,.xlsx,.xls" style="display:none" />
          </div>
          <div id="import-summary" class="muted" style="margin-top:10px">Belum ada file.</div>
        </div>
        <div class="field" style="margin-top:12px">
          <label>Pratinjau (maks. 50 baris)</label>
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Tanggal</th>
                  <th>Tipe</th>
                  <th>Kategori</th>
                  <th>Keterangan</th>
                  <th class="text-right">Jumlah</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="import-tbody">
                <tr><td colspan="6" class="empty">Pilih file untuk pratinjau.</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn soft pressable" id="btn-cancel-import"><i class="fas fa-ban"></i><span>Batal</span></button>
        <button class="btn primary pressable" id="btn-commit-import" disabled><i class="fas fa-check"></i><span>Impor</span></button>
      </div>
    </div>
  </div>

  <!-- Import Error Modal -->
  <div id="import-error-modal" class="modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="import-error-title">
    <div class="modal-backdrop" data-close></div>
    <div class="modal-card" style="max-width: 560px;">
      <div class="modal-header">
        <h3 id="import-error-title"><i class="fas fa-triangle-exclamation"></i> Gagal Memproses File</h3>
        <button class="btn soft pressable" id="btn-close-import-error" aria-label="Tutup"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <p id="import-error-message" class="error-message">Format file tidak dikenali. Pastikan kolom: Tanggal, Keterangan, Kategori, Jumlah.</p>
      </div>
      <div class="modal-footer">
        <button class="btn primary pressable" id="btn-ok-import-error"><i class="fas fa-check"></i><span>Mengerti</span></button>
      </div>
    </div>
  </div>
        <div class="title-group">
          <h1>Laporan Keuangan</h1>
          <p class="subtitle">Dashboard analisis pemasukan, pengeluaran, dan saldo terkini</p>
        </div>
      </div>
      <div class="header-actions">
        <button class="action-btn secondary" id="btn-print">
          <i class="fas fa-print"></i>
          <span>Cetak</span>
        </button>
        <button class="action-btn secondary" id="btn-export">
          <i class="fas fa-file-export"></i>
          <span>Ekspor</span>
        </button>
        <button class="action-btn secondary" id="btn-import">
          <i class="fas fa-file-import"></i>
          <span>Impor</span>
        </button>
        <button class="action-btn secondary" id="btn-rollback">
          <i class="fas fa-undo"></i>
          <span>Batalkan Impor Terakhir</span>
        </button>
        <button class="action-btn primary" id="btn-open-drawer">
          <i class="fas fa-plus-circle"></i>
          <span>Buat Laporan</span>
        </button>
      </div>
    </div>
  </section>

  <!-- Monthly Dues Section -->
  <section class="card-container dues-section">
    <div class="card-header">
      <h3><i class="fas fa-coins"></i> Iuran Bulanan</h3>
      <p class="card-subtext">Atur nominal dan periode iuran. Hanya bulan berjalan yang dapat disimpan.</p>
    </div>
    <div class="card-content">
      <div class="dues-config">
        <div class="input-group">
          <label>Nominal Iuran/Bulan</label>
          <div class="input-affix">
            <span class="affix prefix">Rp</span>
            <input type="number" id="iuran-amount" min="0" step="1000" placeholder="0" class="form-input" />
            <span class="affix suffix">/bulan</span>
          </div>
          <div class="help-text">Contoh: 200000 • masukkan angka tanpa titik/koma</div>
        </div>
        <div class="input-group">
          <label>Periode Bulan</label>
          <div class="month-navigation">
            <button type="button" class="month-nav-btn prev-month" aria-label="Bulan sebelumnya">
              <i class="fas fa-chevron-left"></i>
            </button>
            <div class="field-pill">
              <button type="button" class="icon-btn calendar-btn" aria-label="Pilih bulan">
                <i class="far fa-calendar-alt"></i>
              </button>
              <input type="month" id="iuran-month" class="month-input" />
            </div>
            <button type="button" class="month-nav-btn next-month" aria-label="Bulan selanjutnya">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
          <div class="help-text">Hanya bulan berjalan yang bisa disimpan</div>
        </div>
        <div class="input-group">
          <label aria-hidden="true">&nbsp;</label>
          <button class="action-btn primary" id="iuran-save">
            <i class="fas fa-save"></i>
            <span>Simpan</span>
          </button>
        </div>
      </div>
      <div class="section-divider" aria-hidden="true"></div>
      <div class="dues-grid">
        <div class="dues-column">
          <h4 class="column-title success">
            <span class="pill success"><i class="fas fa-check-circle"></i> Pembayaran Bulan Ini</span>
          </h4>
          <div id="iuran-paid" class="status-grid"></div>
        </div>
        <div class="dues-column">
          <h4 class="column-title warning">
            <span class="pill warning"><i class="fas fa-clock"></i> Menunda (Belum Bayar)</span>
          </h4>
          <div id="iuran-pending" class="status-grid"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- Filter Controls -->
  <section class="card-container filter-section">
    <div class="filter-toolbar">
      <div class="filter-grid">
        <div class="input-group">
          <label>Preset Periode</label>
          <div class="chip-container">
            <button class="filter-chip active" data-preset="bulan-ini">Bulan ini</button>
            <button class="filter-chip" data-preset="hari-ini">Hari ini</button>
            <button class="filter-chip" data-preset="bulan-lalu">Bulan lalu</button>
            <button class="filter-chip" data-preset="qtd">QTD</button>
            <button class="filter-chip" data-preset="ytd">YTD</button>
            <button class="filter-chip" data-preset="semua">Semua</button>
          </div>
        </div>
        <div class="input-group">
          <label for="filter-start">Dari Tanggal</label>
          <input type="date" id="filter-start" class="form-input" />
        </div>
        <div class="input-group">
          <label for="filter-end">Sampai Tanggal</label>
          <input type="date" id="filter-end" class="form-input" />
        </div>
        <div class="input-group">
          <label for="filter-min">Min Jumlah</label>
          <input type="number" id="filter-min" placeholder="0" min="0" step="1000" class="form-input" />
        </div>
        <div class="input-group">
          <label for="filter-max">Max Jumlah</label>
          <input type="number" id="filter-max" placeholder="—" min="0" step="1000" class="form-input" />
        </div>
        <div class="input-group">
          <label for="filter-q">Pencarian</label>
          <div class="search-input" id="search-box">
            <i class="fas fa-search" aria-hidden="true"></i>
            <input type="text" id="filter-q" placeholder="Cari keterangan, kategori, atau tipe..." class="form-input" aria-label="Cari" />
            <button type="button" class="search-clear" id="btn-clear-search" aria-label="Bersihkan pencarian">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
      </div>
      <div class="filter-actions">
        <button id="btn-reset" class="action-btn secondary">
          <i class="fas fa-undo"></i>
          <span>Reset</span>
        </button>
      </div>
    </div>
  </section>

  <!-- KPI Summary Cards -->
  <section class="kpi-grid">
    <div class="kpi-card income">
      <div class="kpi-icon">
        <i class="fas fa-arrow-trend-up"></i>
      </div>
      <div class="kpi-details">
        <div class="kpi-label">Total Pemasukan</div>
        <div class="kpi-value" id="sum-in">Rp0</div>
      </div>
    </div>
    <div class="kpi-card expense">
      <div class="kpi-icon">
        <i class="fas fa-arrow-trend-down"></i>
      </div>
      <div class="kpi-details">
        <div class="kpi-label">Total Pengeluaran</div>
        <div class="kpi-value" id="sum-out">Rp0</div>
      </div>
    </div>
    <div class="kpi-card balance">
      <div class="kpi-icon">
        <i class="fas fa-wallet"></i>
      </div>
      <div class="kpi-details">
        <div class="kpi-label">Saldo Akhir</div>
        <div class="kpi-value" id="sum-bal">Rp0</div>
      </div>
    </div>
    <div class="kpi-card transactions">
      <div class="kpi-icon">
        <i class="fas fa-receipt"></i>
      </div>
      <div class="kpi-details">
        <div class="kpi-label">Total Transaksi</div>
        <div class="kpi-value" id="sum-count">0</div>
      </div>
    </div>
  </section>

  <!-- Charts Section -->
  <section class="charts-grid">
    <div class="chart-card">
      <div class="card-header">
        <h3><i class="fas fa-chart-line"></i> Tren Saldo Harian</h3>
        <div class="card-actions">
          <button class="action-button" aria-label="Unduh grafik" title="Unduh PNG">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/>
              <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
          </button>
          <button class="action-button" aria-label="Layar penuh" title="Layar penuh">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 3 21 3 21 9"/>
              <polyline points="9 21 3 21 3 15"/>
              <line x1="21" y1="3" x2="14" y2="10"/>
              <line x1="3" y1="21" x2="10" y2="14"/>
            </svg>
          </button>
        </div>
      </div>
      <div class="chart-container">
        <div class="chart-skeleton" id="sk-balance"></div>
        <canvas id="lap-balance"></canvas>
      </div>
    </div>
    <div class="chart-card">
      <div class="card-header">
        <h3><i class="fas fa-chart-pie"></i> Komposisi Dana</h3>
        <div class="card-actions">
          <button class="action-button" aria-label="Unduh grafik" title="Unduh PNG">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/>
              <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
          </button>
          <button class="action-button" aria-label="Layar penuh" title="Layar penuh">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 3 21 3 21 9"/>
              <polyline points="9 21 3 21 3 15"/>
              <line x1="21" y1="3" x2="14" y2="10"/>
              <line x1="3" y1="21" x2="10" y2="14"/>
            </svg>
          </button>
        </div>
      </div>
      <div class="chart-container">
        <div class="chart-skeleton" id="sk-mix"></div>
        <canvas id="lap-mix"></canvas>
      </div>
    </div>
    <div class="chart-card">
      <div class="card-header">
        <h3><i class="fas fa-chart-column"></i> Perbandingan In vs Out</h3>
        <div class="card-actions">
          <button class="action-button" aria-label="Unduh grafik" title="Unduh PNG">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/>
              <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
          </button>
          <button class="action-button" aria-label="Layar penuh" title="Layar penuh">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 3 21 3 21 9"/>
              <polyline points="9 21 3 21 3 15"/>
              <line x1="21" y1="3" x2="14" y2="10"/>
              <line x1="3" y1="21" x2="10" y2="14"/>
            </svg>
          </button>
        </div>
      </div>
      <div class="chart-container">
        <div class="chart-skeleton" id="sk-inout"></div>
        <canvas id="lap-inout"></canvas>
      </div>
    </div>
  </section>

  <!-- Analysis Section -->
  <section class="analysis-grid">
    <div class="card-container reports-card">
      <div class="card-header">
        <h3><i class="fas fa-folder-open"></i> Riwayat Laporan</h3>
      </div>
      <div class="card-content">
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Laporan</th>
                <th>Periode</th>
                <th>Tipe</th>
                <th>Keterangan</th>
                <th class="text-right">Jumlah</th>
                <th class="text-right">Saldo Sekarang</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody id="report-tbody">
              <tr class="empty-row">
                <td colspan="7" class="empty-state">
                  <div class="empty-content">
                    <i class="fas fa-inbox"></i>
                    <p>Belum ada laporan tersimpan</p>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="report-note" id="active-report-note"></div>
      </div>
    </div>
  </section>

  <!-- AI Insights -->
  <section class="insights-section">
    <div class="card-container">
      <div class="card-header">
        <h3><i class="fas fa-brain"></i> AI Insights</h3>
      </div>
      <div class="card-content">
        <div id="insight-list" class="insights-container">
          <div class="loading-state">Menganalisis pola keuangan...</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Anomaly Detection (moved) -->
  <section class="anomaly-section">
    <div class="card-container">
      <div class="card-header">
        <h3><i class="fas fa-triangle-exclamation"></i> Deteksi Anomali</h3>
      </div>
      <div class="card-content">
        <ul class="anomaly-list" id="anom-list">
          <li class="loading-state">Menganalisis data transaksi...</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Report Creation Drawer -->
  <aside class="drawer" id="drawer">
    <div class="drawer-header">
      <h3><i class="fas fa-file-alt"></i> Buat Laporan</h3>
      <button class="close-btn" id="btn-close-drawer">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <form id="form-report" class="drawer-content">
      <div class="form-section">
        <div class="section-header">
          <h4><i class="fas fa-receipt"></i> Data Laporan (Gaya Transaksi)</h4>
        </div>

        <div class="form-row">
          <div class="input-group">
            <label for="tx-type">Tipe</label>
            <select id="tx-type" class="form-input">
              <option value="Masuk">Pemasukan</option>
              <option value="Keluar">Pengeluaran</option>
              <option value="Transaksi">Transaksi</option>
            </select>
          </div>
          <div class="input-group">
            <label for="tx-date">Tanggal</label>
            <input id="tx-date" type="date" class="form-input" />
          </div>
        </div>

        <div class="form-row">
          <div class="input-group">
            <label for="tx-category">Kategori</label>
            <select id="tx-category" class="form-input">
              <option value="Iuran">Iuran</option>
              <option value="Keamanan">Keamanan</option>
              <option value="Donasi">Donasi</option>
              <option value="Donatur">Donatur</option>
              <option value="Lingkungan">Lingkungan</option>
              <option value="Kebersihan">Kebersihan</option>
              <option value="Sosial">Sosial</option>
              <option value="Fasilitas">Fasilitas</option>
              <option value="Administrasi">Administrasi</option>
            </select>
          </div>
          <div class="input-group">
            <label for="tx-amount">Jumlah (Rp)</label>
            <input id="tx-amount" type="number" min="0" step="1000" placeholder="0" class="form-input" />
          </div>
        </div>

        <div class="input-group">
          <label for="tx-desc">Keterangan</label>
          <input id="tx-desc" type="text" placeholder="Contoh: Iuran Bulanan / Pembelian ATK" class="form-input" />
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="action-btn primary full-width">
          <i class="fas fa-save"></i>
          <span>Simpan Laporan</span>
        </button>
      </div>
    </form>
  </aside>

  <div class="drawer-backdrop" id="drawer-backdrop"></div>

  <!-- Toast Container -->
  <div id="toast-wrap" class="toast-container"></div>

  <!-- Export Modal -->
  <div id="export-modal" class="modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="export-title">
    <div class="modal-backdrop" data-close></div>
    <div class="modal-card">
      <div class="modal-header">
        <h3 id="export-title"><i class="fas fa-file-export"></i> Ekspor Laporan</h3>
        <button class="btn soft pressable" id="btn-close-export" aria-label="Tutup"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <div class="field">
          <label>Format</label>
          <div class="chip-group" role="group" aria-label="Pilih format ekspor">
            <button class="chip active" data-format="xlsx"><i class="fas fa-file-excel"></i> Excel (.xlsx)</button>
            <button class="chip" data-format="pdf"><i class="fas fa-file-pdf"></i> PDF</button>
            <button class="chip" data-format="doc"><i class="fas fa-file-word"></i> Word (.doc)</button>
          </div>
        </div>
        <div class="field">
          <label>Pemisahan</label>
          <select id="export-split">
            <option value="none" selected>Satu tabel (gabung)</option>
            <option value="type">Pisah per Tipe (Masuk/Keluar)</option>
            <option value="category">Pisah per Kategori</option>
          </select>
        </div>
        <div class="template-actions">
          <button class="btn soft pressable" id="btn-template-excel"><i class="fas fa-table"></i><span>Template Excel</span></button>
          <button class="btn soft pressable" id="btn-template-word"><i class="fas fa-file-word"></i><span>Template Word</span></button>
        </div>
        <div id="export-summary" class="muted" style="margin-top:10px">Data mengikuti filter saat ini.</div>
      </div>
      <div class="modal-footer">
        <button class="btn soft pressable" id="btn-cancel-export"><i class="fas fa-ban"></i><span>Batal</span></button>
        <button class="btn primary pressable" id="btn-do-export"><i class="fas fa-download"></i><span>Unduh</span></button>
      </div>
    </div>
  </div>

  <style>
    * {
      box-sizing: border-box;
    }

    :root {
      /* Design System - Colors */
      --primary-50: #eff6ff;
      --primary-100: #dbeafe;
      --primary-500: #3b82f6;
      --primary-600: #2563eb;
      --primary-700: #1d4ed8;
      
      --success-50: #f0fdf4;
      --success-100: #dcfce7;
      --success-500: #22c55e;
      --success-600: #16a34a;
      
      --warning-50: #fffbeb;
      --warning-100: #fef3c7;
      --warning-500: #f59e0b;
      --warning-600: #d97706;
      
      --error-50: #fef2f2;
      --error-100: #fee2e2;
      --error-500: #ef4444;
      --error-600: #dc2626;
      
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-300: #d1d5db;
      --gray-400: #9ca3af;
      --gray-500: #6b7280;
      --gray-600: #4b5563;
      --gray-700: #374151;
      --gray-800: #1f2937;
      --gray-900: #111827;
      
      /* Semantic Colors */
      --surface: #ffffff;
      --surface-secondary: var(--gray-50);
      --surface-tertiary: var(--gray-100);
      --border: var(--gray-200);
      --border-strong: var(--gray-300);
      --text-primary: var(--gray-900);
      --text-secondary: var(--gray-600);
      --text-tertiary: var(--gray-500);
      
      /* Spacing Scale */
      --space-1: 0.25rem;
      --space-2: 0.5rem;
      --space-3: 0.75rem;
      --space-4: 1rem;
      --space-5: 1.25rem;
      --space-6: 1.5rem;
      --space-8: 2rem;
      --space-10: 2.5rem;
      --space-12: 3rem;
      --space-16: 4rem;
      
      /* Border Radius */
      --radius-sm: 0.375rem;
      --radius-md: 0.5rem;
      --radius-lg: 0.75rem;
      --radius-xl: 1rem;
      --radius-2xl: 1.5rem;
      
      /* Shadows */
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
      
      /* Typography */
      --font-size-xs: 0.75rem;
      --font-size-sm: 0.875rem;
      --font-size-base: 1rem;
      --font-size-lg: 1.125rem;
      --font-size-xl: 1.25rem;
      --font-size-2xl: 1.5rem;
      --font-size-3xl: 1.875rem;
      --font-size-4xl: 2.25rem;
      
      --line-height-tight: 1.25;
      --line-height-normal: 1.5;
      --line-height-relaxed: 1.625;
      
      /* Transitions */
      --transition-fast: 150ms ease;
      --transition-normal: 300ms ease;
      --transition-slow: 500ms ease;
      
      /* Z-Index Scale */
      --z-dropdown: 10;
      --z-overlay: 20;
      --z-modal: 1000;
      --z-toast: 50;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --surface: var(--gray-900);
        --surface-secondary: var(--gray-800);
        --surface-tertiary: var(--gray-700);
        --border: var(--gray-700);
        --border-strong: var(--gray-600);
        --text-primary: var(--gray-100);
        --text-secondary: var(--gray-400);
        --text-tertiary: var(--gray-500);
      }
    }

    /* Base Styles */
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      line-height: var(--line-height-normal);
      color: var(--text-primary);
      background: var(--surface-secondary);
      margin: 0;
      padding: 0;
      word-wrap: break-word;
      overflow-wrap: break-word;
      hyphens: auto;
    }

    /* Layout Components */
    .header-section {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-2xl);
      padding: var(--space-6);
      margin-bottom: var(--space-6);
      box-shadow: var(--shadow-sm);
    }

    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--space-6);
    }

    .header-info {
      display: flex;
      align-items: center;
      gap: var(--space-4);
    }

    .icon-container {
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
      border-radius: var(--radius-xl);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: var(--font-size-xl);
      box-shadow: var(--shadow-md);
    }

    .title-group h1 {
      margin: 0;
      font-size: var(--font-size-3xl);
      font-weight: 800;
      letter-spacing: -0.025em;
      line-height: var(--line-height-tight);
    }

    .subtitle {
      margin: var(--space-1) 0 0;
      color: var(--text-secondary);
      font-weight: 500;
      line-height: var(--line-height-normal);
    }

    .header-actions {
      display: flex;
      gap: var(--space-3);
      align-items: center;
    }

    /* Card Components */
    .card-container {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-2xl);
      box-shadow: var(--shadow-sm);
      overflow: hidden;
      margin-bottom: var(--space-6);
    }

    .card-header {
      padding: var(--space-5) var(--space-6);
      border-bottom: 1px solid var(--border);
      background: var(--surface-secondary);
    }

    .card-header h3 {
      margin: 0;
      display: flex;
      align-items: center;
      gap: var(--space-3);
      font-size: var(--font-size-lg);
      font-weight: 700;
      color: var(--text-primary);
    }

    /* Dues section header layout: title on the left, description on the right */
    .dues-section .card-header {
      display: grid;
      grid-template-columns: auto 1fr;
      column-gap: var(--space-6);
      align-items: center;
    }
    .dues-section .card-header h3 { margin: 0; }
    .dues-section .card-header .card-subtext {
      margin: 0;
      color: var(--text-secondary);
      line-height: var(--line-height-normal);
    }
    @media (max-width: 640px) {
      .dues-section .card-header { grid-template-columns: 1fr; row-gap: var(--space-2); }
    }

    .card-content {
      padding: var(--space-6);
    }

    /* Button Components */
    .action-btn {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-3) var(--space-4);
      border-radius: var(--radius-lg);
      font-weight: 600;
      font-size: var(--font-size-sm);
      transition: all var(--transition-fast);
      cursor: pointer;
      border: none;
      text-decoration: none;
      white-space: nowrap;
    }

    .action-btn.primary {
      background: var(--primary-500);
      color: white;
      box-shadow: var(--shadow-sm);
    }

    .action-btn.secondary {
      background: var(--surface-tertiary);
      color: var(--text-primary);
      border: 1px solid var(--border);
    }

    .action-btn.full-width {
      width: 100%;
      justify-content: center;
    }

    .action-btn:active {
      transform: translateY(1px);
    }

    .action-btn:focus-visible {
      outline: 2px solid var(--primary-500);
      outline-offset: 2px;
    }

    /* Fancy buttons for iuran actions (global: injected by JS) */
    :global(.btn-pay) {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--success-500), var(--success-600));
      color: #fff;
      border: none;
      box-shadow: 0 6px 16px rgba(34,197,94,0.25);
      font-weight: 700;
      font-size: 12px;
      letter-spacing: .2px;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), opacity var(--transition-fast);
      position: relative;
      overflow: hidden;
    }
    :global(.btn-pay i) { font-size: 12px; }
    :global(.btn-pay:hover) { transform: translateY(-1px); box-shadow: 0 10px 22px rgba(34,197,94,0.35); }
    :global(.btn-pay:active) { transform: translateY(0); }
    :global(.btn-pay:disabled) { opacity: .75; cursor: not-allowed; box-shadow: none; }
    :global(.btn-pay:focus-visible) { outline: 2px solid var(--success-300); outline-offset: 2px; }
    :global(.btn-pay .ripple) {
      position: absolute; inset: 0; border-radius: inherit; pointer-events: none;
      background: radial-gradient(600px 600px at var(--x,50%) var(--y,50%), rgba(255,255,255,0.35), transparent 55%);
      animation: ripple-fade .5s ease-out;
    }

    :global(.btn-unpay) {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--warning-500), var(--warning-600));
      color: #fff;
      border: none;
      box-shadow: 0 6px 16px rgba(245,158,11,0.25);
      font-weight: 700;
      font-size: 12px;
      letter-spacing: .2px;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), opacity var(--transition-fast);
      position: relative;
      overflow: hidden;
    }
    :global(.btn-unpay i) { font-size: 12px; }
    :global(.btn-unpay:hover) { transform: translateY(-1px); box-shadow: 0 10px 22px rgba(245,158,11,0.35); }
    :global(.btn-unpay:active) { transform: translateY(0); }
    :global(.btn-unpay:disabled) { opacity: .75; cursor: not-allowed; box-shadow: none; }
    :global(.btn-unpay:focus-visible) { outline: 2px solid var(--warning-300); outline-offset: 2px; }
    :global(.btn-unpay .ripple) {
      position: absolute; inset: 0; border-radius: inherit; pointer-events: none;
      background: radial-gradient(600px 600px at var(--x,50%) var(--y,50%), rgba(255,255,255,0.35), transparent 55%);
      animation: ripple-fade .5s ease-out;
    }

    @keyframes ripple-fade { from { opacity: .6; } to { opacity: 0; } }

    /* Iuran paid/pending lists (global: injected by JS) */
    :global(.dues-grid) {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-6);
    }
    @media (max-width: 900px) { :global(.dues-grid) { grid-template-columns: 1fr; } }

    :global(.dues-column .column-title) {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 0 0 var(--space-3);
      font-weight: 800;
      letter-spacing: .2px;
    }
    :global(.dues-column .column-title.success) { color: var(--success-600); }
    :global(.dues-column .column-title.warning) { color: var(--warning-600); }

    :global(.pill) {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: .2px;
      border: 1px solid var(--border);
      background: var(--surface-secondary);
      color: var(--text-primary);
    }
    :global(.pill i) { font-size: 12px; }
    :global(.pill.success) { border-color: var(--success-100); background: var(--success-50); color: var(--success-600); }
    :global(.pill.warning) { border-color: var(--warning-100); background: var(--warning-50); color: var(--warning-600); }

    :global(.status-grid) {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: var(--space-3);
    }

    :global(.status-pill) {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--space-3);
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: var(--surface);
      transition: box-shadow var(--transition-fast), transform var(--transition-fast), border-color var(--transition-fast);
    }
    :global(.status-pill:hover) { box-shadow: var(--shadow-sm); transform: translateY(-1px); border-color: var(--border-strong); }

    :global(.pill-name) {
      flex: 1 1 auto;
      min-width: 0;
      color: var(--text-primary);
      font-weight: 600;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* Empty and loading states inside dues lists */
    :global(.status-grid .empty-state),
    :global(.status-grid .loading-state) {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 14px 16px;
      color: var(--text-secondary);
      background: var(--surface-secondary);
      border: 1px dashed var(--border);
      border-radius: 12px;
      grid-column: 1 / -1;
      font-size: 14px;
    }

    /* Ripple effect for action buttons */
    .btn-pay .ripple, .btn-unpay .ripple {
      position: absolute;
      width: 12px; height: 12px;
      pointer-events: none;
      border-radius: 999px;
      transform: translate(-50%, -50%);
      background: rgba(255,255,255,0.5);
      animation: ripple-fade 450ms ease-out;
    }
    @keyframes ripple-fade {
      from { opacity: .6; transform: translate(-50%, -50%) scale(1); }
      to   { opacity: 0; transform: translate(-50%, -50%) scale(14); }
    }

    /* Month navigation controls */
    .month-nav {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 4px;
    }
    .btn-month {
      width: 34px;
      height: 34px;
      border-radius: 10px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border: 1px solid var(--border);
      background: var(--surface-tertiary);
      color: var(--text-primary);
      transition: all var(--transition-fast);
    }
    .btn-month:hover { background: var(--primary-50); border-color: var(--primary-500); color: var(--primary-700); }
    .btn-month:active { transform: translateY(1px); }

    /* Status pills layout */
    .status-grid .status-pill{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: linear-gradient(180deg, #fff, var(--surface-secondary));
    }
    .status-grid .pill-name{ font-weight: 600; color: var(--text-primary); }

    /* Form Components */
    .input-group {
      display: flex;
      flex-direction: column;
      gap: var(--space-2);
    }

    .input-group label {
      font-size: var(--font-size-sm);
      font-weight: 600;
      color: var(--text-secondary);
    }

    .form-input {
      padding: var(--space-3) var(--space-4);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      background: var(--surface);
      color: var(--text-primary);
      font-size: var(--font-size-sm);
      font-weight: 500;
      transition: all var(--transition-fast);
      outline: none;
    }

    .form-input:focus {
      border-color: var(--primary-500);
      box-shadow: 0 0 0 3px rgb(59 130 246 / 0.1);
    }

    /* Input with prefix/suffix (currency) */
    .input-affix {
      position: relative;
      display: flex;
      align-items: center;
    }
    .input-affix .form-input {
      width: 100%;
      padding-left: 56px; /* space for Rp */
      padding-right: 72px; /* space for /bulan */
    }
    .affix {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: var(--surface);
      color: var(--text-secondary);
      border: 1px solid var(--border);
      padding: 6px 10px;
      border-radius: var(--radius-lg);
      font-weight: 700;
      font-size: var(--font-size-xs);
      pointer-events: none;
    }
    .affix.prefix { left: 6px; }
    .affix.suffix { right: 6px; }

    .search-input {
      position: relative;
      display: flex;
      align-items: center;
      width: 100%;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 6px 12px 6px 10px;
      transition: box-shadow var(--transition-fast), border-color var(--transition-fast), background var(--transition-fast);
    }

    .search-input i {
      position: absolute;
      left: 10px;
      color: var(--primary-700);
      z-index: 1;
      width: 28px; height: 28px;
      display: inline-flex; align-items: center; justify-content: center;
      background: var(--primary-50);
      border: 1px solid var(--primary-100);
      border-radius: 999px;
    }

    .search-input .form-input {
      padding-left: 46px; /* account for icon chip */
      width: 100%;
      border: none;
      background: transparent;
      box-shadow: none;
    }
    .search-input .form-input::placeholder { color: var(--text-tertiary); }
    .search-input:focus-within { border-color: var(--primary-300); box-shadow: 0 0 0 4px var(--primary-50); }

    .search-input .search-clear {
      position: absolute;
      right: 8px;
      width: 28px; height: 28px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: var(--surface-tertiary);
      color: var(--text-secondary);
      display: inline-flex; align-items: center; justify-content: center;
      cursor: pointer;
      transition: opacity var(--transition-fast), transform var(--transition-fast), border-color var(--transition-fast);
      opacity: 0; pointer-events: none;
    }
    .search-input .search-clear:hover { transform: translateY(-1px); border-color: var(--border-strong); }
    .search-input.has-content .search-clear { opacity: 1; pointer-events: auto; }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: var(--space-3);
    }

    .checkbox-group input[type="checkbox"] {
      width: var(--space-4);
      height: var(--space-4);
      accent-color: var(--primary-500);
    }

    .error-message {
      color: var(--error-500);
      font-size: var(--font-size-xs);
      font-weight: 500;
    }

    .help-text {
      margin-top: var(--space-1);
      color: var(--text-secondary);
      font-size: var(--font-size-xs);
    }

    /* Filter Section */
    .filter-section {
      margin-bottom: var(--space-8);
    }

    .filter-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      gap: var(--space-6);
      padding: var(--space-6);
      flex-wrap: wrap; /* allow wrapping to avoid collisions */
    }

    .filter-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-4);
      flex: 1;
      align-items: end;
    }

    .chip-container {
      display: flex;
      gap: var(--space-2);
      flex-wrap: wrap;
    }

    .filter-actions {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      flex: 0 0 auto; /* don't shrink */
      margin-left: auto; /* keep to the right on wide screens */
    }

    .filter-chip {
      padding: var(--space-2) var(--space-4);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      background: var(--surface-tertiary);
      color: var(--text-primary);
      font-size: var(--font-size-sm);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .filter-chip.active {
      background: var(--primary-500);
      color: white;
      border-color: var(--primary-500);
    }

    .filter-chip:focus-visible {
      outline: 2px solid var(--primary-500);
      outline-offset: 2px;
    }

    /* KPI Cards */
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--space-6);
      margin-bottom: var(--space-8);
    }

    .kpi-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-2xl);
      padding: var(--space-6);
      display: flex;
      align-items: center;
      gap: var(--space-4);
      box-shadow: var(--shadow-sm);
      position: relative;
      overflow: hidden;
    }

    .kpi-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
    }

    .kpi-card.income::before { background: var(--success-500); }
    .kpi-card.expense::before { background: var(--error-500); }
    .kpi-card.balance::before { background: var(--primary-500); }
    .kpi-card.transactions::before { background: var(--warning-500); }

    .kpi-icon {
      width: 52px;
      height: 52px;
      border-radius: var(--radius-xl);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--font-size-xl);
      color: white;
    }

    .kpi-card.income .kpi-icon { background: linear-gradient(135deg, var(--success-500), var(--success-600)); }
    .kpi-card.expense .kpi-icon { background: linear-gradient(135deg, var(--error-500), var(--error-600)); }
    .kpi-card.balance .kpi-icon { background: linear-gradient(135deg, var(--primary-500), var(--primary-600)); }
    .kpi-card.transactions .kpi-icon { background: linear-gradient(135deg, var(--warning-500), var(--warning-600)); }

    .kpi-details {
      flex: 1;
    }

    .kpi-label {
      font-size: var(--font-size-sm);
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: var(--space-1);
    }

    .kpi-value {
      font-size: var(--font-size-2xl);
      font-weight: 800;
      color: var(--text-primary);
      line-height: var(--line-height-tight);
    }

    /* Charts Section */
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: var(--space-6);
      margin-bottom: var(--space-8);
    }

    .chart-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-2xl);
      box-shadow: var(--shadow-sm);
      overflow: hidden;
    }

    .chart-container {
      padding: var(--space-6);
      height: 320px;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .chart-container canvas {
      width: 100% !important;
      height: 100% !important;
    }

    .chart-skeleton {
      position: absolute;
      inset: var(--space-4);
      border-radius: var(--radius-lg);
      background: linear-gradient(90deg, var(--surface-tertiary) 25%, transparent 50%, var(--surface-tertiary) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }

    .empty-chart {
      position: absolute;
      inset: var(--space-4);
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px dashed var(--border);
      border-radius: var(--radius-lg);
      background: var(--surface-secondary);
      color: var(--text-tertiary);
      font-weight: 600;
    }

    /* Analysis Section */
    .analysis-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-6);
      margin-bottom: var(--space-8);
    }
    /* Make the report history card occupy full width */
    .analysis-grid .reports-card {
      grid-column: 1 / -1;
    }

    .anomaly-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: var(--space-4);
    }

    .anomaly-item {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: var(--space-4);
      padding: var(--space-4);
      background: var(--surface-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
    }

    .anomaly-content {
      flex: 1;
    }

    .anomaly-date {
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: var(--space-1);
    }

    .anomaly-description {
      font-size: var(--font-size-sm);
      color: var(--text-secondary);
      line-height: var(--line-height-relaxed);
    }

    .anomaly-badge {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-2) var(--space-3);
      border-radius: var(--radius-md);
      font-size: var(--font-size-xs);
      font-weight: 700;
      white-space: nowrap;
    }

    .anomaly-badge.warning {
      background: var(--warning-100);
      color: var(--warning-700);
      border: 1px solid var(--warning-200);
    }

    .anomaly-badge.critical {
      background: var(--error-100);
      color: var(--error-700);
      border: 1px solid var(--error-200);
    }

    .loading-state, .empty-state {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--space-8);
      color: var(--text-tertiary);
      font-weight: 500;
    }

    .empty-content {
      text-align: center;
    }

    .empty-content i {
      font-size: var(--font-size-3xl);
      color: var(--text-tertiary);
      margin-bottom: var(--space-3);
    }

    .empty-content p {
      margin: 0;
      color: var(--text-secondary);
      font-weight: 500;
    }

    /* Table Styles */
    .table-container {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      max-width: 100%;
    }

    .data-table {
      width: 100%;
      min-width: 650px;
      border-collapse: separate; /* allow rounded rows */
      border-spacing: 0 10px; /* vertical gap between rows */
      font-size: var(--font-size-sm);
    }

    .data-table th {
      background: var(--surface-tertiary);
      color: var(--text-secondary);
      font-weight: 700;
      text-align: left;
      padding: var(--space-4);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 1;
    }

    /* Table polish: consistent vertical alignment and spacing */
    .data-table th,
    .data-table td {
      vertical-align: middle;
    }
    /* Row cards */
    .data-table tbody tr td {
      background: var(--surface);
      border-top: 1px solid var(--border);
      border-bottom: 1px solid var(--border);
      transition: background var(--transition-fast), border-color var(--transition-fast);
    }
    .data-table tbody tr td:first-child {
      border-left: 1px solid var(--border);
      border-top-left-radius: var(--radius-lg);
      border-bottom-left-radius: var(--radius-lg);
    }
    .data-table tbody tr td:last-child {
      border-right: 1px solid var(--border);
      border-top-right-radius: var(--radius-lg);
      border-bottom-right-radius: var(--radius-lg);
    }
    .data-table tbody tr:hover td { border-color: var(--border-strong); background: var(--surface); }

    /* Amount emphasis */
    .data-table .amount { font-weight: 800; color: var(--text-primary); }

    /* Badges (global to support injected HTML) */
    :global(.badge) {
      display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; border-radius: 999px;
      font-size: 12px; font-weight: 700; letter-spacing: .2px; border: 1px solid var(--border); color: var(--text-primary);
      background: var(--surface-tertiary);
    }
    :global(.badge i) { font-size: 12px; }
    :global(.badge.success) { background: var(--success-50); border-color: var(--success-100); color: var(--success-600); }
    :global(.badge.error) { background: var(--error-50); border-color: var(--error-100); color: var(--error-600); }
    :global(.badge.primary) { background: var(--primary-50); border-color: var(--primary-100); color: var(--primary-700); }
    :global(.badge.neutral) { background: var(--gray-100); border-color: var(--gray-200); color: var(--text-secondary); }
    /* Hint/subtext and quote inside first cell */
    .data-table td:first-child .cell-hint { margin-top: 6px; font-size: 12px; color: var(--text-tertiary); }
    .data-table td:first-child .cell-sub.quote { margin-top: 4px; color: #334155; font-style: italic; }

    /* Delete button polish */
    .data-table .btn.soft.small.pressable {
      border: 1px solid var(--border);
      background: var(--surface-tertiary);
      color: var(--text-primary);
      border-radius: 10px;
      padding: 6px 10px;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), border-color var(--transition-fast);
    }
    .data-table .btn.soft.small.pressable:hover { transform: translateY(-1px); box-shadow: var(--shadow-sm); border-color: var(--border-strong); }
    .data-table .btn.soft.small.pressable i { color: var(--error-600); }
    .data-table td:first-child .cell-main {
      font-weight: 700;
      color: var(--text-primary);
      line-height: 1.2;
    }
    .data-table td:first-child .cell-sub {
      margin-top: 4px;
      font-size: 12px;
      color: var(--text-secondary);
    }
    .data-table td:first-child .cell-sub.quote {
      margin-top: 2px;
      color: #334155;
      font-style: italic;
    }
    .data-table td:first-child .cell-hint {
      margin-top: 4px;
      font-size: 12px;
      color: var(--text-secondary);
    }
    .data-table tbody tr[data-active-row="true"] {
      background-color: rgba(59, 130, 246, 0.05);
    }
    /* Make action cell content aligned nicely */
    .data-table td:last-child {
      white-space: nowrap;
    }
    .btn.small { padding: 6px 10px; font-size: 12px; }

    /* Precise numeric alignment (left-aligned per request) */
    .data-table td.num-col,
    .data-table th.text-right {
      text-align: left;
      white-space: nowrap;
      font-variant-numeric: tabular-nums lining-nums;
      font-feature-settings: 'tnum' 1, 'lnum' 1;
    }
    .data-table td.num-col .amount {
      display: inline-block;
      font-variant-numeric: tabular-nums lining-nums;
      font-feature-settings: 'tnum' 1, 'lnum' 1;
      letter-spacing: 0;
    }

    .data-table th.text-right {
      text-align: left;
    }

    .data-table td {
      padding: var(--space-4);
      border-bottom: 1px solid var(--border);
      color: var(--text-primary);
    }

    .data-table tbody tr:nth-child(even) {
      background: var(--surface-secondary);
    }

    .text-right {
      text-align: right;
      font-weight: 700;
      white-space: nowrap;
    }

    .report-note {
      margin-top: var(--space-4);
      padding: var(--space-3);
      background: var(--surface-secondary);
      border-radius: var(--radius-md);
      font-size: var(--font-size-sm);
      color: var(--text-secondary);
      font-style: italic;
    }

    /* Dues Section */
    .dues-section {
      margin-bottom: var(--space-8);
    }

    /* Dues card header polish */
    .dues-section .card-header {
      background: linear-gradient(180deg, var(--surface-secondary), transparent);
    }
    .dues-section .card-header i {
      color: var(--primary-500);
    }

    /* Divider between config and lists */
    .section-divider {
      height: 1px;
      background: var(--border);
      margin: var(--space-4) 0 var(--space-6);
      border-radius: 1px;
    }

    .dues-config {
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      gap: var(--space-4);
      align-items: end;
      margin-bottom: var(--space-6);
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-xl);
      padding: var(--space-4);
    }

    /* Month Navigation */
    .month-navigation {
      display: flex;
      align-items: center;
      gap: 6px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: var(--surface);
      padding: 6px;
      box-shadow: var(--shadow-sm);
      transition: box-shadow var(--transition-fast), border-color var(--transition-fast);
    }
    
    .month-navigation:focus-within {
      border-color: var(--primary-500);
      box-shadow: 0 0 0 4px rgb(59 130 246 / 0.12);
    }

    .month-nav-btn {
      width: 34px;
      height: 34px;
      border-radius: 8px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border: 1px solid transparent;
      background: transparent;
      color: var(--text-primary);
      transition: all var(--transition-fast);
      cursor: pointer;
    }
    
    .month-nav-btn:hover {
      background: var(--surface-tertiary);
      border-color: var(--border);
      color: var(--primary-700);
      transform: translateY(-1px);
    }
    
    .month-nav-btn:active {
      transform: translateY(0);
    }
    
    .month-nav-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      background: var(--surface-tertiary);
      color: var(--text-tertiary);
    }
    
    .month-nav-btn:disabled:hover {
      transform: none;
      background: var(--surface-tertiary);
      border-color: var(--border);
      color: var(--text-tertiary);
    }

    /* Clean pill month field */
    .field-pill {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: var(--surface);
    }
    
    .field-pill:focus-within {
      border-color: var(--primary-500);
      box-shadow: 0 0 0 4px rgb(59 130 246 / 0.12);
    }
    .field-pill i { color: var(--text-tertiary); }
    .field-pill .chevron { margin-left: auto; }
    .field-pill .month-input {
      border: none;
      outline: none;
      background: transparent;
      width: 100%;
      padding: 4px 0;
      color: var(--text-primary);
      font-weight: 700;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
    }
    /* Hide native indicator but keep it clickable */
    .field-pill .month-input::-webkit-calendar-picker-indicator {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 22px;
      height: 22px;
      opacity: 0;
      cursor: pointer;
    }
    .field-pill .month-input::-webkit-inner-spin-button,
    .field-pill .month-input::-webkit-clear-button { display: none; }

    /* Icon button (calendar) */
    .icon-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--surface-secondary);
      color: var(--text-secondary);
      cursor: pointer;
      transition: background var(--transition-fast), border-color var(--transition-fast), box-shadow var(--transition-fast);
    }
    .icon-btn:hover { background: var(--surface); }
    .icon-btn:focus-visible { outline: none; box-shadow: 0 0 0 3px rgb(59 130 246 / 0.3); border-color: var(--primary-500); }
    .calendar-btn i { pointer-events: none; }
    /* Month input with left calendar icon */
    .input-with-icon {
      position: relative;
      display: flex;
      align-items: center;
    }
    .input-with-icon i {
      position: absolute;
      left: 12px;
      color: var(--text-tertiary);
      pointer-events: none;
    }
    .input-with-icon .month-input {
      padding-left: 40px;
    }
    /* Improve native month picker hit area */
    .month-input::-webkit-calendar-picker-indicator {
      cursor: pointer;
      opacity: 0.85;
    }

    /* Primary button polish (scoped) */
    .dues-section .action-btn.primary {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      background: linear-gradient(180deg, var(--primary-500), var(--primary-600));
      color: #fff;
      border: 1px solid var(--primary-600);
      border-radius: 10px;
      box-shadow: 0 6px 14px rgba(29, 78, 216, 0.25);
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), filter var(--transition-fast);
    }
    .dues-section .action-btn.primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 18px rgba(29, 78, 216, 0.3);
      filter: brightness(1.02);
    }
    .dues-section .action-btn.primary:active {
      transform: translateY(0);
      box-shadow: 0 4px 10px rgba(29, 78, 216, 0.22);
    }

    .dues-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-6);
    }

    .dues-column {
      display: flex;
      flex-direction: column;
      gap: var(--space-4);
    }

    /* Dues column title badges */
    .dues-column .column-title.success i { color: var(--success-600); }
    .dues-column .column-title.warning i { color: var(--warning-600); }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 999px;
      font-weight: 600;
      border: 1px solid var(--border);
      background: var(--surface-secondary);
      color: var(--text-secondary);
    }
    .pill.success {
      background: var(--success-50, #f0fdf4);
      border-color: var(--success-200, #bbf7d0);
      color: var(--success-700, #15803d);
    }
    .pill.warning {
      background: var(--warning-50, #fffbeb);
      border-color: var(--warning-200, #fde68a);
      color: var(--warning-700, #b45309);
    }

    /* Empty state for iuran lists */
    #iuran-paid.status-grid:empty::before,
    #iuran-pending.status-grid:empty::before {
      content: 'Belum ada data untuk periode ini';
      display: block;
      text-align: center;
      padding: calc(var(--space-6) + 4px);
      border: 1px solid var(--border);
      border-radius: var(--radius-xl);
      color: var(--text-secondary);
      background: linear-gradient(180deg, var(--surface), var(--surface-secondary));
      text-align: center;
      font-weight: 600;
    }

    .column-title {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      margin: 0;
      font-size: var(--font-size-base);
      font-weight: 700;
    }

    .column-title.success {
      color: var(--success-600);
    }

    .column-title.warning {
      color: var(--warning-600);
    }

    .status-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: var(--space-3);
    }

    .status-pill {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: var(--space-3);
      padding: var(--space-4);
      background: var(--surface-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      font-weight: 600;
    }

    .pill-name {
      flex: 1;
      color: var(--text-primary);
    }

    .pill-status {
      font-size: var(--font-size-xs);
      font-weight: 700;
      color: var(--success-600);
    }

    .pill-status.warning {
      color: var(--warning-600);
    }

    /* Pending Dues — Enhanced UI */
    /* Column differentiation */
    .dues-column .column-title.warning {
      display: flex;
      align-items: center;
      gap: var(--space-3);
    }
    /* Make pending list visually distinct without changing markup */
    #iuran-pending.status-grid {
      background: linear-gradient(180deg, var(--warning-50), transparent 60%);
      border: 1px dashed var(--warning-100);
      border-radius: var(--radius-xl);
      padding: var(--space-4);
    }
    /* Card styling for each pending resident */
    #iuran-pending .status-pill {
      position: relative;
      background: var(--surface);
      border: 1px solid var(--warning-100);
      box-shadow: var(--shadow-sm);
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast);
      overflow: hidden;
    }
    /* Left accent bar */
    #iuran-pending .status-pill::before {
      content: '';
      position: absolute;
      inset: 0 auto 0 0;
      width: 6px;
      background: linear-gradient(180deg, var(--warning-500), var(--warning-600));
      opacity: 0.9;
    }
    /* Soft background glow */
    #iuran-pending .status-pill::after {
      content: '';
      position: absolute;
      top: -20%;
      right: -20%;
      width: 160px;
      height: 160px;
      border-radius: 50%;
      background: radial-gradient(closest-side, rgba(245, 158, 11, 0.1), transparent);
      pointer-events: none;
    }
    /* Name styling */
    #iuran-pending .pill-name {
      font-weight: 700;
      color: var(--text-primary);
    }
    /* Action button emphasis for pending */
    #iuran-pending .btn-pay {
      background: linear-gradient(135deg, var(--success-500), var(--success-600));
      color: #fff;
      border: none;
      box-shadow: 0 6px 16px rgba(34,197,94,0.25);
    }
    #iuran-pending .btn-pay:hover { box-shadow: 0 10px 22px rgba(34,197,94,0.35); }
    /* Hover interactions */
    #iuran-pending .status-pill:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
      background: linear-gradient(0deg, var(--surface), var(--warning-50));
    }
    /* Paid list keeps neutral styling */
    #iuran-paid .status-pill {
      border-left: 6px solid var(--success-500);
    }

    /* Dues actions — button polish */
    .dues-section .action-btn {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      padding: calc(var(--space-2) + 2px) var(--space-4);
      border-radius: var(--radius-md);
      font-weight: 700;
      line-height: 1;
      transition: background var(--transition-fast), color var(--transition-fast), border-color var(--transition-fast), transform var(--transition-fast);
      box-shadow: 0 0 0 0 rgba(0,0,0,0);
    }
    .dues-section .action-btn i {
      font-size: 0.95em;
    }
    .dues-section .action-btn:focus-visible {
      outline: 2px solid var(--primary-400);
      outline-offset: 2px;
    }
    .dues-section .action-btn:hover {
      transform: translateY(-1px);
    }

    /* Paid list: undo to pending ("Tandai Belum Bayar") */
    #iuran-paid .btn-unpay {
      background: linear-gradient(135deg, var(--warning-500), var(--warning-600));
      color: #fff;
      border: none;
      box-shadow: 0 6px 16px rgba(245,158,11,0.25);
    }
    #iuran-paid .btn-unpay:hover { box-shadow: 0 10px 22px rgba(245,158,11,0.35); }

    /* Insights Section (global: items injected by JS) */
    .insights-section {
      margin-bottom: var(--space-8);
    }
    :global(.insights-container) {
      display: flex;
      flex-direction: column;
      gap: var(--space-4);
    }
    :global(.insight-item) {
      display: flex;
      align-items: flex-start;
      gap: var(--space-4);
      padding: var(--space-4);
      background: var(--surface-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), border-color var(--transition-fast);
    }
    :global(.insight-item:hover) { transform: translateY(-1px); box-shadow: var(--shadow-sm); border-color: var(--border-strong); }
    :global(.insight-item i) {
      color: var(--primary-600);
      font-size: var(--font-size-lg);
      margin-top: var(--space-1);
      flex-shrink: 0;
      background: var(--primary-50);
      border: 1px solid var(--primary-100);
      width: 36px; height: 36px; border-radius: 10px;
      display: inline-flex; align-items: center; justify-content: center;
    }

    .insight-content {
      flex: 1;
      line-height: var(--line-height-relaxed);
    }

    :global(.insight-content strong) {
      color: var(--text-primary);
      font-weight: 700;
    }

    :global(.insight-content) {
      color: var(--text-secondary);
      line-height: var(--line-height-relaxed);
    }

    /* Anomaly Section (global) */
    :global(.anomaly-list) {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: var(--space-4);
    }
    :global(.anomaly-item) {
      padding: var(--space-4);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      background: var(--surface-secondary);
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), border-color var(--transition-fast);
      position: relative;
    }
    :global(.anomaly-item:hover) { transform: translateY(-1px); box-shadow: var(--shadow-sm); border-color: var(--border-strong); }
    /* Left accent */
    :global(.anomaly-item::before) {
      content: '';
      position: absolute;
      left: 0; top: 0; bottom: 0;
      width: 4px;
      background: linear-gradient(180deg, var(--primary-500), var(--primary-600));
      border-top-left-radius: var(--radius-lg);
      border-bottom-left-radius: var(--radius-lg);
    }
    :global(.anomaly-header) {
      display: flex; align-items: center; justify-content: space-between;
      font-weight: 700; color: var(--text-primary); margin-bottom: var(--space-2);
    }
    :global(.anomaly-date) {
      color: var(--text-primary);
      font-size: var(--font-size-xs);
      background: var(--surface);
      border: 1px solid var(--border);
      padding: 6px 10px;
      border-radius: 999px;
      font-weight: 700;
    }
    :global(.anomaly-message),
    :global(.anomaly-description) { color: var(--text-secondary); line-height: var(--line-height-relaxed); }
    :global(.severity),
    :global(.anomaly-badge) {
      display: inline-flex; align-items: center; gap: 8px; padding: 6px 10px; border-radius: 999px;
      font-size: 12px; font-weight: 700; border: 1px solid var(--border);
    }
    :global(.severity i),
    :global(.anomaly-badge i) { font-size: 12px; }
    :global(.severity.warning),
    :global(.anomaly-badge.warning) { background: var(--warning-50); border-color: var(--warning-100); color: var(--warning-600); }
    :global(.severity.critical),
    :global(.anomaly-badge.critical) { background: var(--error-50); border-color: var(--error-100); color: var(--error-600); }

    /* Layout for anomaly content block used by TS */
    :global(.anomaly-content) {
      display: flex; flex-direction: column; gap: 6px;
    }

    /* Drawer Styles */
    .drawer {
      position: fixed;
      top: 0;
      right: -560px;
      width: 560px;
      max-width: 100vw;
      height: 100vh;
      background: var(--surface);
      border-left: 1px solid var(--border);
      box-shadow: var(--shadow-xl);
      z-index: var(--z-modal);
      display: flex;
      flex-direction: column;
      transition: right var(--transition-normal);
      overflow-x: hidden;
    }

    .drawer.open {
      right: 0;
    }

    .drawer-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--space-6);
      border-bottom: 1px solid var(--border);
      background: var(--surface-secondary);
      position: sticky;
      top: 0;
      z-index: 2;
    }

    .drawer-header h3 {
      margin: 0;
      display: flex;
      align-items: center;
      gap: var(--space-3);
      font-size: var(--font-size-xl);
      font-weight: 700;
      color: var(--text-primary);
    }

    .close-btn {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      background: var(--surface-tertiary);
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .close-btn:focus-visible {
      outline: 2px solid var(--primary-500);
      outline-offset: 2px;
    }

    .drawer-content {
      padding: var(--space-6);
      display: flex;
      flex-direction: column;
      gap: var(--space-6);
      overflow-y: auto;
      flex: 1;
    }

    .form-section {
      display: flex;
      flex-direction: column;
      gap: var(--space-5);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-4);
    }

    .form-divider {
      height: 1px;
      background: var(--border);
      margin: var(--space-4) 0;
    }

    .adjustments-section {
      display: flex;
      flex-direction: column;
      gap: var(--space-4);
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .section-header h4 {
      margin: 0;
      display: flex;
      align-items: center;
      gap: var(--space-3);
      font-size: var(--font-size-lg);
      font-weight: 700;
      color: var(--text-primary);
    }

    .adjustments-list {
      display: flex;
      flex-direction: column;
      gap: var(--space-4);
    }

    .adjustment-row {
      display: grid;
      grid-template-columns: 1fr 120px 160px 40px;
      gap: var(--space-3);
      align-items: end;
    }
    
    @media (max-width: 480px) {
      .adjustment-row {
        grid-template-columns: 1fr 80px 100px 40px;
        font-size: var(--font-size-sm);
      }
    }

    .delete-btn {
      width: 40px;
      height: 40px;
      background: var(--error-50);
      border: 1px solid var(--error-200);
      color: var(--error-600);
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .delete-btn:focus-visible {
      outline: 2px solid var(--error-500);
      outline-offset: 2px;
    }

    /* Preview Section */
    .preview-section {
      padding: var(--space-5);
      background: var(--surface-secondary);
      border: 2px dashed var(--border-strong);
      border-radius: var(--radius-lg);
    }

    .preview-section h4 {
      margin: 0 0 var(--space-4);
      font-size: var(--font-size-lg);
      font-weight: 700;
      color: var(--text-primary);
    }

    .preview-stats {
      display: flex;
      flex-direction: column;
      gap: var(--space-3);
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .stat-item .label {
      font-weight: 600;
      color: var(--text-secondary);
    }

    .stat-item .value {
      font-weight: 800;
      font-size: var(--font-size-lg);
      color: var(--text-primary);
    }

    .form-actions {
      display: flex;
      justify-content: flex-end;
      margin-top: var(--space-6);
    }

    /* Backdrop */
    .drawer-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(4px);
      z-index: var(--z-overlay);
      opacity: 0;
      pointer-events: none;
      transition: opacity var(--transition-normal);
    }

    .drawer-backdrop.open {
      opacity: 1;
      pointer-events: auto;
    }

    /* Toast Notifications */
    .toast-container {
      position: fixed;
      bottom: var(--space-6);
      right: var(--space-6);
      z-index: var(--z-toast);
      display: flex;
      flex-direction: column;
      gap: var(--space-3);
    }

    .toast {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      padding: var(--space-4) var(--space-5);
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      max-width: 400px;
      animation: slideIn 0.3s ease;
    }

    .toast-icon {
      width: 24px;
      height: 24px;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--font-size-sm);
      flex-shrink: 0;
    }

    .toast.success .toast-icon {
      background: var(--success-100);
      color: var(--success-600);
    }

    .toast.error .toast-icon {
      background: var(--error-100);
      color: var(--error-600);
    }

    .toast.warning .toast-icon {
      background: var(--warning-100);
      color: var(--warning-600);
    }

    .toast.info .toast-icon {
      background: var(--primary-100);
      color: var(--primary-600);
    }

    .toast-message {
      flex: 1;
      font-weight: 500;
      color: var(--text-primary);
    }

    /* Simple Modal */
    .modal { position: fixed; inset: 0; display: none; z-index: var(--z-modal); }
    .modal.show { display: block; }
    .modal-backdrop { position: absolute; inset: 0; background: rgba(0,0,0,0.45); backdrop-filter: blur(2px); }
    .modal-card { position: relative; margin: 8vh auto; width: min(640px, 94vw); background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-2xl); box-shadow: var(--shadow-xl); overflow: hidden; }
    .modal-header { display: flex; align-items: center; justify-content: space-between; padding: var(--space-5) var(--space-6); border-bottom: 1px solid var(--border); background: var(--surface-secondary); }
    .modal-body { padding: var(--space-6); display: flex; flex-direction: column; gap: var(--space-5); }
    .modal-footer { display: flex; justify-content: flex-end; gap: var(--space-3); padding: var(--space-5) var(--space-6); border-top: 1px solid var(--border); }
    .chip-group { display: flex; gap: 8px; flex-wrap: wrap; }
    .chip { padding: 8px 12px; border: 1px solid var(--border); border-radius: var(--radius-lg); background: var(--surface); cursor: pointer; font-weight: 600; display: inline-flex; align-items: center; gap: 8px; }
    .chip.active { background: var(--primary-500); color: #fff; border-color: var(--primary-500); }
    .template-actions { display: flex; gap: 8px; flex-wrap: wrap; }

    /* Buttons (match transaksi page) */
    .btn{
      display:inline-flex; align-items:center; gap:8px; padding:8px 14px;
      border-radius:999px; border:1px solid var(--outline); font-weight:900;
      background: var(--surface-2); color: var(--text); box-shadow: 0 6px 18px rgba(0,0,0,.06);
      white-space: nowrap;
    }
    .btn.primary{ background:#2563eb; color:#fff; border-color:#1d4ed8; box-shadow:0 10px 22px rgba(37,99,235,.25); }
    .btn.soft{ background: var(--surface-2); color: var(--text); }
    .btn.ghost{ background: transparent; }
    .pressable:active{ transform: translateY(1px); }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
      .filter-grid {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
      
      .charts-grid {
        grid-template-columns: 1fr 1fr;
      }
      
      .kpi-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    @media (max-width: 768px) {
      .header-section {
        padding: var(--space-4);
      }
      
      .header-content {
        flex-direction: column;
        align-items: flex-start;
        gap: var(--space-4);
      }
      
      .header-info {
        width: 100%;
        justify-content: flex-start;
        gap: var(--space-3);
      }
      
      .title-group {
        flex: 1;
      }
      
      .header-actions {
        width: 100%;
        flex-wrap: wrap;
        gap: var(--space-2);
      }
      
      .filter-grid {
        grid-template-columns: 1fr;
      }
      
      .filter-toolbar {
        flex-direction: column;
        align-items: stretch;
      }
      
      .filter-actions {
        width: 100%;
        justify-content: flex-end;
        margin-left: 0;
      }
      
      .charts-grid,
      .analysis-grid,
      .kpi-grid {
        grid-template-columns: 1fr;
      }
      
      .dues-config {
        grid-template-columns: 1fr;
      }
      
      .month-navigation {
        gap: 6px;
        padding: 3px;
      }
      
      .month-nav-btn {
        width: 32px;
        height: 32px;
      }
      
      .dues-grid {
        grid-template-columns: 1fr;
      }
      
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .adjustment-row {
        grid-template-columns: 1fr 1fr;
      }
      
      .drawer {
        width: 100%;
        right: -100%;
      }
      
      .drawer-header {
        padding: var(--space-4);
      }
      
      .drawer-content {
        padding: var(--space-4);
      }
      
      .status-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 480px) {
      :root {
        --space-6: 1rem;
        --space-8: 1.5rem;
      }
      
      .header-section,
      .card-content,
      .drawer-content {
        padding: var(--space-4);
      }
      
      .kpi-card {
        padding: var(--space-4);
        flex-direction: column;
        text-align: center;
      }
      
      .kpi-value {
        font-size: var(--font-size-xl);
      }
      
      .chart-container {
        height: 240px;
        padding: var(--space-4);
      }
      
      .chip-container {
        justify-content: center;
      }
      
      .header-actions {
        flex-direction: column;
        width: 100%;
      }
      
      .action-btn {
        width: 100%;
        justify-content: center;
        min-height: 44px;
      }
      
      /* Meningkatkan ukuran touch target untuk mobile */
      button, 
      .action-button,
      .filter-chip,
      .form-input,
      .search-input,
      select,
      input[type="checkbox"] + label {
        min-height: 44px;
        min-width: 44px;
        touch-action: manipulation;
      }
      
      .form-input,
      .search-input input {
        font-size: 16px; /* Mencegah zoom otomatis di iOS */
        padding: 10px 12px;
      }
      
      .filter-actions,
      .card-actions,
      .header-actions {
        gap: 12px;
      }
      
      /* Text wrapping untuk layar kecil */
      .card-title,
      .section-title,
      .kpi-label,
      .table-header,
      .table-cell,
      .drawer-title,
      .form-label,
      .filter-label,
      .stat-label,
      .insight-title,
      .insight-text,
      .report-title,
      .report-description {
        white-space: normal;
        overflow-wrap: break-word;
        word-wrap: break-word;
        max-width: 100%;
      }
      
      /* Truncate text dengan ellipsis jika terlalu panjang */
      .truncate-text {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 100%;
      }
    }

    /* Print Styles */
    @media print {
      .header-actions,
      .filter-section,
      .drawer,
      .drawer-backdrop,
      .toast-container {
        display: none !important;
      }
      
      .card-container {
        box-shadow: none;
        border: 1px solid #ccc;
        margin-bottom: var(--space-4);
      }
      
      .kpi-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .charts-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Focus and Accessibility */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* Dark mode specific adjustments */
    @media (prefers-color-scheme: dark) {
      .chart-skeleton {
        background: linear-gradient(90deg, var(--gray-800) 25%, transparent 50%, var(--gray-800) 75%);
      }
      
      .kpi-card::before {
        opacity: 0.8;
      }
      
      .toast {
        box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.4), 0 8px 10px -6px rgb(0 0 0 / 0.4);
      }
    }

    /* Reduced motion preferences */
    @media (prefers-reduced-motion: reduce) {
      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
      
      .chart-skeleton {
        animation: none;
        background: var(--surface-tertiary);
      }
    }
  </style>
  <!-- Load Enhanced Animation System (served from public) -->
  <script type="module" src="/js/enhanced-animations.js"></script>
  
  <script type="module" src={laporanClient}></script>
  
  <!-- Load Real-time Chart Update System (public for preview/deploy) -->
  <script type="module" src="/js/shared-state.js"></script>
  <script type="module" src="/js/chart-realtime.js"></script>
  </Layout>